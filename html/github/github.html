

<github-root>

      <template shadowrootmode=open>
      
            <style>
            
  :host 
    {font-family:arial}

  .menu
    {position:absolute;outline:none;font-family:arial}

  section
    {margin-bottom:10px}          
  
  #hdr
    {text-align:right}
  
  #icon
    {padding:2px}
  
  .label
    {}
  
  .hldr
    {display:flex}
  
  .paste
    {margin-right:5px;padding:2px;
      content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAVlJREFUSEvtlj1ug0AQhcdIW6RLeiQy6XKElLRIlOlp6LmBlRsgtzTUOQAtcZMzpMpInAGlQSjRWl7LxrM/dlhZUbwtu/PNvH07zAIutBYX4oIzGBG/95MkIuezXHFOh6MoegqC4F0GEELAMAybWL+BG8GI+AwArypjRFTAgyLOSeAIHIbhjRDii5NHgcdxhK7rWHu4JnEEnt6ljK6AUxIRcfAPInq0mVYL/lwSrNa3UL7d2WKA3CvXw8vuKqzeMYKtxMmGK9ik2FVq+XQ2rVE5VSeXMpLNgLp3fZbUrlCVFAc/GaygbdvaioU4jrU9/W+CVUVc6U3TQJIkfio2geVV/C+pi6KAsiz9SN33PaRpyrrbu9R1XbPgLMv83bHJXHmeQ1VVp0tt6w6zN5DtqHMwynJJeAGbqkVEOefc2xTZ/+7Uq10CcgOh7pzz38kFPMce6zQ4B4SL8QNf7+YfCGbtNAAAAABJRU5ErkJggg==);
    }
  .copy
    {margin-left:5px;padding:2px;
      content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAABSlBMVEVHcEwnz/4C8P4g1P4L6P43wf5Mr/4a2v4Y3P4/uv5PrP4+vf5Auv4ozv5KsP4vyv45wP5Jsf5Auf49vP5Mrv4zxf44wf5Lr/46wP4h1P5Lr/46vv5Jsv4R5P5Hs/5Etv44wf5Hs/41w/4uyv47vv49vP5Ftf5GtP4c2f4rzP4tyv4m0f5Etv5Nrv4xxv4xxv4xx/4W3/5KsP5Mr/4/u/4uyv5Isv4K6f4l0f4qzv4W3/4V3/5Nrv5Mrv5Mrv5Mr/4W3v4e2P5BuP5Hsv4N5v4K6f4O5v42w/5Dt/4E7/4uyf4C8P4nz/4M5/4K6v4oz/4P5f4k0v4b2v5Gs/4E7v4I6/5Nrf4e1/4H7P4E7v5Auv5Dtv4sy/5Isv5GtP4wx/49vP4zxf47vv44wP42w/5LsP5Jsf4i1P4n0P4N5v4k0v4a2v4S4v4X3v6OfcqkAAAAVnRSTlMACo7CjQWN/VczjgIJMfIXJzHtjj5iVekR71Hvtz7CjelXjre2wiJj2PCFIWbR7+fEnXaodz3544/USfOC22Tm7CXOnqfUZ+/3VTV9bsTzqGDahpb2tyRB6bIAAAIDSURBVDjLrZVpV9pAFIYntdFiQkZsLCQECtJSlqAsFRBU3Kuta1sncYGuJEDt///aISkkkyHo6enzLTlP5s5758wNAC526pd3d1++/fzx/evNze1tp210wxURUMTWBz2v2EWtLc7jBTPmoJfNrqy8i0ajixgB00VISJIeW9JMKbcWDAYDNiFMQN1EqAAJcUfSBif0fsQWQjLxpjGnXUJa5CoIbTiP8KJ0OqfNMLQIZhGad/Ke3t///vWwGKv1+yPxfW55+TnmJWZW5ggxcqX3m6WSVTpSdPcxHCLExmf97AI8e1j8cK1f8X9Fq/Sotrf0k2v9KRiJ08L8mwhf2CQx8oK/yJyPw3Q67ULaV4Tr7tRCwFfkllLF4ushccwGPyUMzwzhMQz/X1Kz+QVMmh2LcjgsTxDZ3OpqIpFYfDu+KGwoxE5JvTtpF9NX9BEB792jn0gD4eNEsVAQHyXOO7fQFmNNLZOnPV5BqEyI+Yxm1qkluS0BCWRp8FEze6mTJQtVVd8MUfcEhBSGFOGMOWmaoc0AmRoXP5cmiHEReEXANOopzCsLRYlXjWolGXE2jK/r/ujEWAdOFIxWGrjO8ljXazG6MeynthEn2gAP9P7B4XCE2thzdG2v2jbK5LfHZ3hINbclSco6o/kIh1Einq4e1qxp5m2PkqZ/CPvbXvFot+xe7w/EpaiUrJ24NAAAAABJRU5ErkJggg==);
    }
  .storage
    {margin-right:5px;padding:2px;
      content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAACZFBMVEVHcEy9TEyD1eZpgIXXxLrhjWPyYyfxn3bljF/5jFrrpnnvNB/8ai/yh1bUmnLiaDbqLSDaiG/tOCL5dDT1ilrgXC4SabrEVkTwYSLqe0nxl3XsNx75cC74dTX7i1X2iVv+lVr3jlz0iFr4h1LtnWv7sHj5ZCPkazfVQirbeEX4UhvtaC7uUSXrQSD3KhbwSSz2Zij1ZyutZ1f2d0P3iFnAHhX6h1L4f0v6eT3zjlzumW3nnGzroHHeMiDYSin4Wx3sbTDkdj73ZST3QhrlJx32Sxr0OR3seDzvfj7zfz70OBv1aSzoYyfTSTb0Ziv3h1j2iVnxYCnyVSbtUC3wOSDlNiH2cTrWKSDWKyP3gEX6k2H0hlP1mWfypHXPq4vPo4D1soPZqIjis5LVrI3+Xxv/ejT/civ+Qxf/dzH+JBb+Nhb+byz+LRb/bSj/fTX/URb+aSX+YyH+WRf/ZSH+HBX/PxX/SBX/dTCsEhT/aya7EhP+Shb/NBb9fULoJhj/ZyX+JhT9cjP8YR/tKBv+fjj+g03+UBb/jVn/iFT+kl/+dzrmGxfrKxzuMBzIHBX8Sx76VCzUFxbEFBL+nGj/cSr8XB79Lxz8VyjZLhf7UR/9Yyj+hUX+gEP/l2PyaCr8OhnEIxf6XSbaGha7GBT3RCXhVif3ThnoQxn9Zie1EhL4IxrjJhj7YDDQJxbvPBv7Vhv9hVH/om7AIBX+Uxz0RB/dPhzzOiP2IRfsYiz2MR3zJh7RTSjjSx/lUx/LExXuOxz/jU7+iUn8PCnEKB3IOST4cS/jNBP6SBa9IRLWJxXTJhD2HBcZjAsKAAAAZHRSTlMACQICAyWlLzTrqMH+Tzg0pgrB5Ik+AQumHBrC89n2e/5oj+q1lPU9GhjzgZCQ+6XOqwW0v7/d5e1BdaSBSSf2kEPp5nrw2Xahv9iscRWgqtS/mb+4s47CwNGUYtzWEVqLW0Yax/uzPQAAArxJREFUOMvdlGdXGlEQhjfiGqIgarCLvbcYNfb03nvviRRFdLFEXFySRWx0UASxd7BrNDGxpdc/lbuQE3fB/AHfz8+ZufOcuQNBOzX+YXRmTBQ7NpYdFcOkh/pvT4Ux2bl5exyJi4vLzy/g5NxihrpjUVci21rb24vg3c4U5mFKnJGV5oLCufMA6+voKIGeeRMpjo/82MvFG8RZLAoY2+zgFha8PZ/7gtDpRdEfehRK4Uu5lyeJ87zsBDsWHj5++iQhIcEXigEgVg/Aq+SZPHIw0Lq1PbrvAfyoJD6+mA7dA50BJx66votc8TwDawaZb4tkM+kwDBfev6vEhUiN1WYOoID7SxEc68UwTKlUFnA4eyOEiM06ZNbr56Q+LqAYEQoUPT29QAouZFin9bpPXV3ldS1U0OMSAEWd9dxK8C5EXDqn45dXlNW+auS3SG+QQSi9ugYR8QAo6GyoKa2uelHnAMv5Vd/9aOSKfpnjNifIc4DSur8VJ34doLTe91ZlWVv5ylVweaJ/FX/Lfv6wG+9QQK/udyqD9vOX1dWxsfX1tYlly4x2RCKRoDOzAVRQbjWPalSGDSNqlzhjR42GqdluaTgVJPQIGdP60TcatVotkzU1Nb2frBgAU4cHu4IinqBSwcVFNrnptY4/0FVWW0boobSGrpnECHnqLT3Sm9kUPQOm7cBG/vg3Vz2yiSEh0ZoMTmosWuNt8htphJ5hy/LYSn9/v9w0N740q5ka3kDt6Mwm5Y20ELnYPKpWDRu02sHBwcXFkREUJfRsdlOXghZC6MGBniVCj2yK8AP0EMO4g+56HNtDEQ5dkIvJ29OypUeXEUQGg9OOba8nNf0i9WPTWEc4EYJK6j5mnssIzHa/KSlHT585C75LYuLh1JPHT/n4nTiYHPSfKxXknwKzkpICA1mHkoNpO/YYQ38AABZHleIztVMAAAAASUVORK5CYII=);
    }
  
  .value
    {}
  
  #btns
    {display:flex;justify-content:center;gap:25px}
  [value=save]
    {margin-right:20px}
  
  input
    {font-size:16px;padding:5px 10px;box-sizing:border-box;}
  input:not([type])
    {flex:1}
  input[type=button]
    {cursor:pointer}
  
  #url
    {margin-right:10px}
                  
            </style>
      
      
            <img id=icon class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAZ9JREFUSEvNls8uBEEQxn9DXFgughNZ3sBNwk3iMYTH4GJPvIQEryFxI3HyBkLcEBf/DsKiNmbSad1d1TO7oW/T/fX31VddPdUF+WMKOAbaP1uvgTXgPoeqMIJfgNEMbEvDasLPwJhGEll/Te1NCX/WFPS3BTViwv0SLYP4peNPjABvfXLq0wj3eywS3+k5sFQzkBNg1dtbGXUdh9Lrrn8AQ4YgTJwlSAiF2FQYBvESEjIzDHRL4VgxaddNiyHK+6fCR8D6ANKcSve+OB5UmlPCxIQPgU3tAI3rB8BGqGpDjleAMyOxBlsGTq3C28Cexmhc3wJ2rcLSY+eNxBrsyundFfbfFZdE1vTnoVb1LHATyVdT8dhVndP+XE2cp3p6ERKWuQXg0smC9FHpp5YhWGkEqVEJC8iNMJWJpq+W3n6X5BaYdsKUtZ3v744zJ5mQ6xEai8CF4vQOmAmdX8i14KRfdw151t5qwRdIqPxzqzpZUG7gueelBWLudLnv6jrCWe/qMivjwKNXcKmjdh1PAE8xsObA3fcATCoFZsH0KL4ABKpK0CB/GK0AAAAASUVORK5CYII='>

          
            <div id=github class=menu style='display:none;left:-225px;top:100px;width:450px'>
            
            
                <div class=menu-title>
                      github params
                </div>
                
                <section id=hdr>
                
                      <a href='https://github.com/settings/personal-access-tokens'>github token</a>
                      
                </section>
                
                <section>
                
                      <div>
                            token
                      </div>
                      
                      <div class=hldr>
                          <img class='paste icon'>
                          <img class='storage icon'>
                          <input id=token autocomplete=off>
                          <img class='copy icon'>
                      </div>
                      
                </section>
                
                <div class=menu-sep></div>
                
                <section>
                
                    <div>
                          parse url
                    </div>
                    
                    <div class=hldr>
                        <img class='paste icon'>
                        <input id=url>
                        <input type=button value=parse>
                        <input type=button value='+'>
                    </div>
                    
                </section>
                
                <div class=menu-sep></div>
                
                <section>
                
                      <div>
                            owner
                      </div>
                      
                      <div class=hldr>
                          <img class='paste icon'>
                          <input id=owner autocomplete=off>
                      </div>
                      
                </section>
                
                
                <section>
                
                      <div>
                            repo
                      </div>
                      
                      <div class=hldr>
                          <img class='paste icon'>
                          <input id=repo autocomplete=off>
                      </div>
                      
                </section>
                
                
                <section>
                
                      <div>
                            branch
                      </div>
                      
                      <div class=hldr>
                          <img class='icon paste'>
                          <input id=branch autocomplete=off value=main>
                      </div>
                      
                </section>

                
                <section>
                
                      <div>
                            path
                      </div>
                      
                      <div class=hldr>
                          <img class='icon paste'>
                          <input id=path autocomplete=off>
                      </div>
                      
                </section>

                
                <div id=btns>
                      <input value=load type=button>
                      <input value=load-raw type=button>
                      <input value=save type=button>
                      <input value=backup type=button>
                </div>

                
            </div>

      </template>
      
      <script>

      
mod.github    = function(){
  
  var obj   = {
      version   : 'v1.0'
  };
                                                                                true && debug(obj.version);
        var df=obj.df=false
        ;
  
          
        var menumod,editor,$,par_init,ext
        ;
        
        obj.initmod   = function(params){
          
              menumod       = params.menumod;
              editor        = params.editor;
              $             = params.$;
              par_init      = params.init;
              ext           = params.ext;
              
        }//initmod

                            
  //vars:-                    
        
        var github;
        
        var root;
        var shadow;
          
        var icon;
  
                                    
        var btn   = {};

        
  //:
  

    
        obj.init    = function(){
          
              libs   = libs();
              
        }//init
        
        
        async function libs(){
          
              [github]    = await ext.load.libs('github/github.js.api');
              
        }//load
        

  //:

    
        obj.initdom   = function(rootnode){   //c
  
              root                            = $.$(rootnode,'github-root');
              shadow                          = root.shadowRoot;
  
              menumod.add.style(shadow);
              
              var style                       = $(shadow,'style');
              $.stylesheet.insert(style,'.icon');
              
              var node                        = $(shadow,'.menu');
              icon                            = $(shadow,'#icon');
              icon.onclick                    = menumod.click(node,'both',true,callback);
  
              
              var list    = $.all(node,'input:not([type])');
              list.forEach((input,i)=>{
              
                    input.addEventListener('keydown',keydown);
                    input.onfocus   = e=>input.select();
                    
                    function keydown(e){
                    
                          if(e.key=='ArrowDown'){
                                e.stopPropagation();
                                i++;
                                if(i==list.length){
                                      i   = 0;
                                }
                                var input2    = list[i];
                                input2.focus();
                          }
                          if(e.key=='ArrowUp'){
                                e.stopPropagation();
                                i--;
                                if(i<0){
                                      i   = list.length-1;
                                }
                                var input2    = list[i];
                                input2.focus();
                          }
                          if(e.key=='ArrowLeft'){
                                if(e.ctrlKey){
                                      //debugger;
                                      e.stopPropagation();
                                      menumod.prev();
                                }
                          }
                          if(e.key=='ArrowRight'){
                                if(e.ctrlKey){
                                      e.stopPropagation();
                                      menumod.next();
                                }
                          }
                          
                    }//keydown
                    
              });
              
              $.all(shadow,'.paste').forEach(icon=>{
              
                    icon.onclick    = async e=>{
                                            
                                            var txt       = await navigator.clipboard.readText();
                                            var par       = icon.parentNode;
                                            var input     = $(par,'input:not([type])');
                                            input.value   = txt;
                                            input.focus();
                                            
                                      };
                                      
              });
              
              var root2   = $(shadow,'#token').parentNode;
              $(root2,'.paste').onclick   = async e=>{
                                            
                                                  var txt       = await navigator.clipboard.readText();
                                                  var par       = icon.parentNode;
                                                  var input     = $(par,'input:not([type])');
                                                  input.value   = txt;
                                                  
                                                  if(e.ctrlKey){
                                                        btn.parse();
                                                        btn.load(e);
                                                  }
                                                  
                                            };
                                          
              var token   = window.localStorage['github-token'];
              if(token){
                    $(shadow,'#token').value    = token;
              }
              
              $(shadow,'.copy').onclick   = async e=>{
              
                                                  var icon    = e.target;
                                                  var input   = $(icon.parentNode,'input:not([type])');
                                                  var txt     = input.value;
                                                  await navigator.clipboard.writeText(txt);
                                                  $.mousetext(e,'copied');
                                                  
                                            };
                                          
              $(shadow,'.storage').onclick    = async e=>{
                                                    
                                                      var icon      = e.target;
                                                      var input     = $(icon.parentNode,'input:not([type])');
                                                      if(e.shiftKey){
                                                            var token   = input.value;
                                                            if(!token){
                                                                  $.mousetext('no token');
                                                                  return;
                                                            }
                                                            localStorage.setItem('github-token',token);
                                                            $.mousetext(e,'localStorage[\'github-token\'] saved');
                                                            return;
                                                      }
                                                      
                                                      var token   = localStorage.getItem('github-token');
                                                      if(!token){
                                                            $.mousetext('no stored token, localStorage[\'github-token\']');
                                                            return;
                                                      }
                                                      input.value   = token;
                                                      
                                                };

                                          
              $(shadow,'[value=parse]').onclick   = btn.parse;
              $(shadow,'[value="+"]').onclick     = btn.parse.load;
              
              $(shadow,'#url').onkeydown    = e=>{
              
                                                      if(e.key=='Enter'){
                                                            btn.parse();
                                                            $(shadow,'#load').focus();
                                                      }
                                                  
                                                };
                                                
              $(shadow,'#path').onkeydown     = e=>{
                                                
                                                      if(e.key=='Enter'){
                                                            $(shadow,'#load').focus();
                                                      }
                                                      
                                                };
                                              
              $(shadow,'[value=load]').onclick        = btn.load;
              $(shadow,'[value=load-raw]').onclick    = btn.load.raw;
              $(shadow,'[value=save]').onclick        = btn.save;
              $(shadow,'[value=backup]').onclick      = btn.backup;
              
        }//initdom


  //:

        
        btn.parse   = function(e={}){
        
              if(!github){
                    alert('library not ready');
                    return;
              }
              
              var url   = $(shadow,'#url').value;
              
              var {owner,repo,branch,path}    = github.parse(url);
              
              write(owner,repo,branch,path);
              
              if(e.ctrlKey){
                    btn.load(e);
              }
              
        }//parse

        
        btn.parse.load    = function(e){
        
              btn.parse();
              btn.load(e);
              
        }//parse.load
        
        
        btn.load    = async function(e){
        
              var api   = true;
              if(e.shiftKey){
                    api   = false;
              }
              
              var {token,owner,repo,branch,path}    = read();
              
              var i           = path.lastIndexOf('/');
              var filename    = path.slice(i+1);
              
              var file        = {};
              file.type       = 'github';
              file.filename   = filename;
              file.title      = repo+' : '+path;
              file.icon       = icon.src;
              
              file.owner      = owner;
              file.repo       = repo;
              file.branch     = branch;
              file.path       = path;
              
              var result      = await load(file,api);
              if(result.error){
                    return;
              }
              var blob    = result.ok;
              
              obj.load.complete(file,blob);
                            
        }//load
        
        
        btn.load.raw    = async function(){
          
              load(false);
              
        }//raw

        
        btn.save    = async function(){
        
              var {token,owner,repo,branch,path}    = read();
              
              var i           = path.lastIndexOf('/');
              var filename    = path.slice(i+1);
              
              var file        = {};
              file.type       = 'github';
              file.filename   = filename;
              file.title      = repo+' : '+path;
              file.icon       = icon.src;
              
              file.owner      = owner;
              file.repo       = repo;
              file.branch     = branch;
              file.path       = path;
              
              var blob        = await source(file);
              
              var result      = await save(file,blob);
              if(result.error){
                    return;
              }
              
        }//save
        
        
        btn.backup    = function(){
        
              var {token,owner,repo,branch,path}    = read();
              console.log('btn.backup');
              console.log(token,owner,repo,branch,path);
              
              github.backup(token,owner,repo,branch,path);
              
        }//backup


        
        
        function github_kd(e){
        
              //  only needs to return undefined to stop keydown stack from running
              
              if(e.key=='Escape'){
                    editor.focus();
                    return false;
              }
              
        }//github_kd

        
        function callback(type){
        
              if(type=='show'){
                    $(shadow,'#token').focus();
                    keydown.add(github_kd);
              }
              if(type=='hide'){
                    keydown.rem(github_kd);
              }
              
        }//callback


        obj.read    = read;
        
        function read(){
        
              var token     = read.token();
              var owner     = $(shadow,'#owner').value;
              var repo      = $(shadow,'#repo').value;
              var branch    = $(shadow,'#branch').value;
              var path      = $(shadow,'#path').value;
                                                                                debug(owner,repo,branch,path);
              return {token,owner,repo,branch,path};
              
        }//read
        
        
        read.token    = function(){
          
              var token     = $(shadow,'#token').value;
              return token;
              
        }//token


        obj.write   = write;
        
        function write(owner,repo,branch,path){
                                                                                debug(owner,repo,branch,path);
              $(shadow,'#owner').value    = owner;
              $(shadow,'#repo').value     = repo;
              $(shadow,'#branch').value   = branch;
              $(shadow,'#path').value     = path;
              
        }//write


        obj.clear   = function(){
          
              $(shadow,'#owner').value    = '';
              $(shadow,'#repo').value     = '';
              $(shadow,'#branch').value   = '';
              $(shadow,'#path').value     = '';
                            
        }//clear
        
        
  //:

        
        obj.load    = function(file,api){return load(file,api)}
        
        async function load(file,api){

              var token                       = read.token();
              var {owner,repo,branch,path}    = file;
              
              //var result    = await loadfile(api,token,owner,repo,branch,path);
              var result    = await github.load({token,owner,repo,branch,path});
              return result;
              
        }//load


        obj.save    = function(file,blob){return save(file,blob)}   //d
        
        async function save(file,blob){
        
              var token                       = read.token();
              var {owner,repo,branch,path}    = file;
              
              //var result    = await savefile(token,owner,repo,branch,path,blob);
              var result    = await github.save(token,owner,repo,branch,path,blob);
              if(result.ok){
                    obj.save.complete(file);
              }                            
              return result;
        
        }//save
        

  //:


        obj.export    = function(){
          
              var {owner,repo,branch,path}    = read();
              return {owner,repo,branch,path};
              
        }//export

        
  //:


        obj.icon    = function(){
        
              return icon.src;
              
        }//icon


  //:

  
        function debug(){
        
              if(!df && !obj.df)return;
              var str   = [...arguments].join(' ');
              str       = '[ github ] '+str;
              console.log(str);
              
        }//debug


        
  return obj;
  
}//github

      </script>
    
</github-root>

