


<snippet-console>

      <template shadowrootmode=open>
      
      
            <style>
            
  #root
    {display:flex;flex-direction:column;gap:10px}
    
  input
    {font-size:16px;padding:5px 10px}
  input[type=button]
    {cursor:pointer}
    
            </style>
            
            
            <div id=root>
            
                  <editor component v2.0></editor>
      
                  <div>
                        <input value=run type=button>
                  </div>
                              
                  <console component v2.0></console>
      
            </div>
      
      </template>
      
      
      <script>
      
(function snippet_console({mod,root,node}){
  
  var obj   = {
        version   : 'v2.0',
  };
  
        var df=true,did='snippet-console'
        ;

        
        var ext,$,source,ace,mode,menumod
        ;
        
        obj.initmod   = function(params){
          
              ext       = params.ext;
              $         = params.$;
              source    = params.source;
              ace       = params.ace;
              mode      = params.mode;
              menu      = params.menu;
              menumod   = params.menumod;
              
        }//initmod
        
        
  //:


        var ansi;
  
        var editor;
        obj.editor      = null;
        var con;
        obj.console     = null;
        
        var def    = root.innerHTML;
        console.log(def);
        
        var sandbox;
        
        
        var root;
        
        
        var btn   = {};
        
        
  //:
  
  
        obj.init    = async function(){
                                                                                debug('init',obj.version);
              editor        = mod.editor;
              obj.editor    = editor;
              
              con           = mod.console;
              obj.console   = con;
              
              editor.initmod({ext,$,menu,ace});
              con.initmod({ext,$,ace});


              await Promise.all([              
                    libs(),
                    editor.init(),
                    con.init(),
              ]);

          
        }//init
        
        
        async function libs(){
          
              var promise;
              var list        = [];
              
              promise   = ext.load.libs('js/sandbox/sandbox.js.api').then(result=>[sandbox]=result);
              list.push(promise);
              

              //var {AnsiUp}    = await import('https://cdn.jsdelivr.net/npm/ansi_up/+esm');
              //ansi            = new AnsiUp();
              
              await Promise.all(list);
              
        }//libs

        
  //:
  
  
        obj.initdom   = function(rootnode){

              host                                = $.full('snippet-console',rootnode);
              root                                = host.shadowRoot;


              editor.initdom(root,{txt:def,fullsize:true});
              
              
              $(root,'[value=run]').onclick       = btn.run;
              
              
              con.initdom(root);


              con.clear();
              con.log('ready');

              
        }//initdom
        

  //:
  
        
        btn.run   = function(){

              var js          = editor.getvalue();
              
                    
              var console     = {};
              console.log     = function(){
                              
                                      window.console.log.apply(window.console,arguments);
                                      
                                      var args    = [...arguments];
                                      if(mode=='nodejs'){
                                            args.forEach((v,i)=>{
                                            
                                                  if(typeof v=='string'){
                                                        var html    = ansi.ansi_to_html(v);
                                                        var node    = $.define(html);
                                                        var log     = document.createElement('log-nodejs');
                                                        log.append(node);
                                                        args.splice(i,1,log);
                                                  }
                                                  
                                            });
                                      }
                                      con.log.apply(null,args);
                                    
                                }//log
              console.clear   = function(){
                  
                                      con.clear();
                                      window.console.clear();
                                      
                                }//clear

              if(!mode){
                    sandbox.run(js,{console});
              }else{
                    sandbox[mode](js,{console});
              }

          
              source.focus();
              
        }//run
        
        
  //:


        obj.run   = btn.run;


  //:  
  

        function debug(){
          
              if(!df && !obj.df)return;
              var str   = [...arguments].join(' ');
              console.log(`[ ${did} ]`,str);
              
        }//debug
        


  return obj;
  
})//snippet_console



      </script>
      
      
</snippet-console>




