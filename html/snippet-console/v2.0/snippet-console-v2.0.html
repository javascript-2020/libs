


<snippet-console v2.0>

      <template shadowrootmode=open>
      
      
            <style>
            
  #root
    {display:flex;flex-direction:column;gap:10px;border:1px solid lightgray;padding:10px;border-radius:5px}
    
  input
    {font-size:16px;padding:5px 10px}
  input[type=button]
    {cursor:pointer}
    
            </style>
            
            
            <div id=root>
            
                  <div>
                        <file-mod v2.0 component></file-mod>
                  </div>
                  
                  <web-editor component></web-editor>
                  
                  <div>
                        <input value=run type=button>
                        <input value=clear type=button>
                  </div>
                  
                  <web-console v2.0 component></web-console>
                  
            </div>
            
      </template>
      
      
      <script>
      
(function snippet_console({mod,dom,host}){
                                                                    console.log(mod);
  var obj   = {
        version   : 'v2.0',
  };
  
        var df=true,did='snippet-console'
        ;
        
        
        var ext,$,ace,menu,config={}
        ;
        
        obj.initmod   = function(params){
        
              ext           = mod.rd(params,'ext',ext);
              $             = mod.rd(params,'$',$);
              ace           = mod.rd(params,'ace',ace);
              menu          = mod.rd(params,'menu',menu);
              menumod       = mod.rd(params,'menumod',menumod);
              config        = mod.rd(params,'config',config,{});
              
        }//initmod
        
        
  //:
  
  
        var ansi;
        
        var filemod;
        obj.filemod     = null;
        var editor;
        obj.editor      = null;
        var con;
        obj.console     = null;
        
        var def;
        var src;
        
        
        var sandbox;
        
        
        var root;
        
        
        var rd          = {}
        var attr        = {};
        var btn         = {};
        
        
  //:
  
  
        obj.init    = async function(){
                                                                                debug('init',obj.version);
              rd.config();
              
              def                 = dom.innerHTML;
              
              filemod             = mod['file-mod'];
              obj.filemod         = filemod;
              editor              = mod['web-editor'];
              obj.editor          = editor;
              
              con                 = mod['web-console'];
              obj.console         = con;
              
              filemod.initmod({ext,$,menu,menumod,complete,source});
              editor.initmod({ext,$,menu,ace,});
              con.initmod({ext,$,ace,config:config['web-console']});
              
              
              await Promise.all([
                    attr.src(),
                    libs(),
                    filemod.init(),
                    editor.init(),
                    con.init(),
              ]);
              
              
        }//init
        
        
        async function libs(){
        
              var promise;
              var list        = [];
              
              promise   = ext.load.libs('js/sandbox/sandbox.js.api').then(result=>[sandbox]=result);
              list.push(promise);
              
              
              //var {AnsiUp}    = await import('https://cdn.jsdelivr.net/npm/ansi_up/+esm');
              //ansi            = new AnsiUp();
              
              await Promise.all(list);
              
        }//libs
        
        
        rd.config   = function(){
        
              var node          = $(dom,'config');
              if(node){
                    node.remove();
              }
              node      = mod.config(node);
              if(node.error){
              }
                                                                                //console.log('node.config',node.config);
              config    = Object.assign(config,node.config);
                                                                                //console.log('config',config);
        }//config
        
        
        attr.src    = async function(){
        
              if(!dom.hasAttribute('src'))return;
              src       = dom.getAttribute('src');
              var res   = await fetch(src);
              var txt   = await res.text();
              def       = txt;
              
        }//src
        
        
  //:
  
  
        obj.initdom    = function(){
        
              var shadow                          = host.shadowRoot;
              
              
              filemod.initdom();
              editor.initdom({txt:def,fullsize:true});
              
              
              $(shadow,'[value=run]').onclick       = btn.run;
              $(shadow,'[value=clear]').onclick     = btn.clear;
              
              con.initdom();
              
              
              if(src){
                    editor.filename(src);
              }
              
              con.clear();
              con.log('ready');
              
              
        }//initdom2
        
        
        
        
        
  //:
  
  
        btn.run   = function(){
        
              var js          = editor.getvalue();
              
              sandbox.run(js,{console:con});
              
              editor.focus();
              
        }//run
        
        
        btn.clear   = function(){
        
              con.clear();
              
        }//clear
        
        
  //:
  
  
        obj.run   = btn.run;
        
        
        
  //:
  
  
        function source(){
        
              var txt     = editor.getvalue();
              var blob    = new Blob([txt]);
              return blob;
              
        }//source
        
        
        function complete(){
        }//complete
        
        
        complete.load   = function(file,blob){
        }//load
        
        
        complete.save   = function(file){
        }//save
        
        
  //:
  
  
        function debug(...args){
        
              if(!df && !obj.df)return;
              args.unshift(`[ ${did} ]`);
              var fmt     = Array.from({length:args.length}).fill('%O').join(' ');
              var args2   = [fmt].concat(args);
              console.groupCollapsed.apply(console,args2);
              console.trace();
              console.groupEnd();
              
        }//debug
        
        
        
  return obj;
  
})//snippet_console



      </script>
      
      
</snippet-console>




