


<html>

      <head>
      
            <script init>
                                                                                console.clear();
                                                                                console.json=v=>console.log(JSON.stringify(v,null,4));
        var version       = 'v1.0';
            
        var df            = true;


        var ext;
        var $;
        var datatype;
        var menumod;
        var keydown;
        var debug;
        

        var mod           = {};


        var ace;
        var snippet_console;        
        

        

  //:

              
        async function init(){
                                                                                debug('init',version);

              //editor                    = mod.editor();
              snippet_console           = mod['snippet-console']();
              
              
              //editor.initmod({ext,$,menu:menu.root});
              snippet_console.initmod({ext,$,ace,source});
              
              //await editor.init();
              await snippet_console.init();
              
              
  //:

          
              await initdom(document.body);


        }//init


  //:
  
  
        init.stack            = [];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = '';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              init.stack.ct>=init.stack.total && init();
        }});
        

(async()=>{
  
        init.stack.add;
        
        
        var url;
        var headers;
        var token       = localStorage['github-token'];
        if(token){
              url       = 'https://api.github.com/repos/javascript-2020/ext-code/contents/ext-loader.js';
              headers   = {accept:'application/vnd.github.raw',authorization:`bearer ${token}`};
        }else{
              url       = 'https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js';
        }
        
        var res   = await fetch(url,{headers});
        var txt   = await res.text();

        if(res.headers.get('content-type').includes('json')){
                                                                                console.log('*** ext : json');
              var json    = JSON.parse(txt);
              var b64     = json.content;
              txt         = atob(b64);
        }else{
                                                                                console.log('*** ext : text');
        }
        
        ext   = eval(txt);
        
              
        var promise   = ext.load.libs(
              'js/dom/$.js.api',
              'js/core/datatype.js',
              'js/dom/menumod/menumod.js',
              'js/dom/keydown/keydown.js',
              'js/debug/debug.js',
        );
        [$,datatype,menumod,keydown,debug]   = await promise;

        ace   = await $.editor.ace();
        
        init.stack.complete;

})();


            </script init>
      
            <style>
            </style>
            
      </head>
      
      
      <body>
      
            <code>
            
            
        fn();

        
        function fn(){
        
              console.log('myFn');
              
        }//fn
        
            </code>

            
            <snippet-console>
                  <script html-loader src='https://html-loader-1024713184986.us-central1.run.app/'></script>
            </snippet-console>

      
      </body>
      
      
      <script>

      
        var root;
        var code;
        

        function initdom(rootnode){
        
              root    = rootnode;
              
              
              code    = $('code');
              
              //editor.initdom(root);
              
              snippet_console.initdom(root);
              

              
        }//initdom
      

  //:
  
  
        function source(){
        
              var js    = code.textContent;
              return js;
              
        }//source
        
        
        source.focus    = function(){}

        
  //:
  
  
  init.stack.complete;
  
      </script>
      
      
</html>


