

<html>

      <head>
      
            <style>
            
  .icon
    {border:1px solid gray;border-radius:3px;box-sizing:border-box;width:32px;height:32px;cursor:pointer}
            
            </style>
      
            <script init>
            
                                                                                console.clear();
        var mod   = {};
        
        var ext,$,datatype,menumod,keydown
        ;
        
        var googlestorage;
        
        
        function init(){
        
        
              menumod         = menumod();
              
              
              googlestorage   = mod['google-storage']();
              
              googlestorage.initmod({ext,$,menumod});
              googlestorage.load.complete   = complete.load;
              googlestorage.save.complete   = complete.save;
              googlestorage.init();
              

          
              initdom(document.body);
              
          
        }//init
        

        init.stack            = [];
        init.stack.ct         = 0;
        init.stack.total      = 1;
        init.stack.mode       = '';
        init.stack.complete   = false;
        Object.defineProperty(init.stack,'add',{get:()=>{console.log('add');
              init.stack.total++;
              init.stack.mode && console[init.stack.mode]('add',init.stack.ct,init.stack.total);
        }});
        Object.defineProperty(init.stack,'complete',{get:()=>{console.log('complete');
              init.stack.ct++;
              init.stack.mode && console[init.stack.mode]('complete',init.stack.ct,init.stack.total);
              init.stack.ct>=init.stack.total && init();
        }});
        
        //  (typeof init!='undefined' && init?.stack && init.stack.add)
        //  (typeof init!='undefined' && init?.stack && init.stack.complete)
  
        
        init.complete   = function(){
          
              init.complete.stack.forEach(fn=>fn());
              
        }//complete
        
        init.complete.stack   = [];
        init.complete.add     = fn=>init.complete.stack.push(fn);
      

(async()=>{
  
        init.stack.add;
        
        var token   = localStorage['github-token'];
        var url;
        var headers;
        if(token){
              url       = 'https://api.github.com/repos/javascript-2020/ext-code/contents/ext-loader.js';
              headers   = {accept:'application/vnd.github.raw',authorization:`bearer ${token}`};
        }else{
              url       = 'https://raw.githubusercontent.com/javascript-2020/ext-code/main/ext-loader.js';
        }
        
        await fetch(url,{headers}).then(res=>res.text()).then(complete);

            
        async function complete(txt){

              ext           = eval(txt);
              var promise   = ext.load.libs(
                    'js/dom/$.js.api',
                    'js/core/datatype.js',
                    'js/dom/menumod/menumod.js',
                    'js/dom/keydown/keydown.js',
              );
              [$,datatype,menumod,keydown]   = await promise;

              init.stack.complete;

        }//ext_fn

})();
            
            </script init>
            
      </head>
      
      
      
      <body>
      
      
            <google-storage api>
                  <script src='https://html-loader-1024713184986.us-central1.run.app/'></script>
            </google-storage>
      
      
      </body>
      

      <script>
      
      
        function initdom(rootnode){
          
              var root                  = rootnode;
              
              
              googlestorage.initdom(root);
              
              
        }//initdom
        
        

        
        function complete(){
          
        }//complete
        
        
        complete.load   = async function(file,blob){
          
              var txt   = await blob.text();
              alert(txt);
              
        }//load
        
        
        complete.save   = function(file){
          
              alert(file.filename+' saved');
              
        }//save




        
        init.stack.complete;
        
      </script>
      
</html>



