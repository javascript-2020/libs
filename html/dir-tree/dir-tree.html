
<dir-tree>

      <template shadowrootmode=open>
      
            <style>
            
  #tree
    {display:flex;flex-direction:column;gap:10px;border:1px solid lightgray;padding:10px}
    
  .dir
    {display:flex;flex-direction:column;gap:10px;overflow:hidden;transition:0.3s;max-height:500px}
  .dir-hdr
    {display:flex;align-items:center;gap:20px;padding:5px 10px;cursor:pointer}
  .expand
    {width:17px;transition:0.2s}
  .close
    {transform:rotateZ(-90deg)}
  .dir-name
    {}
  .dir-list
    {display:flex;flex-direction:column;gap:10px}
    
  .file
    {display:flex;gap:20px;align-items:center;cursor:pointer;padding:5px 10px}
    
  .icon
    {width:25px;height:25px}
    
            </style>
            
            
            <div id=tree style='visibility:hidden'>
            
                  <div class=dir>
                        <div class=dir-hdr>
                              <img class=expand src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAATCAMAAACwcE1OAAAAS1BMVEVHcExGhb9Df7hGe61OjMdHhsF+suFbl89emtBPjceAtOJ7sOBPjcg/erNgm9JPjcdbmM9qo9ZJh8NKiMKz2vyYxu6cyfGy2ful0PVtT2pPAAAAFHRSTlMAIAUCcSj3uMB5+fV+A8hW2utHRnteqoAAAACRSURBVCjPldFLEoMgDABQgkT5CGob0PuftFCKTgXtNJt83iaTMPYzntia4iPnaXENR7dMKcO8hdrRhW2GWHBh1spRhtUInsouucRau9xkh0NBBjLClvbkID31hzJmhSFfHIaTJu/JD7Crst+rWvXxpu5+ocWjasVbR+ZKk4868vZr+KjpWt9+o8nvNO5n2T/xAsuTB8PYb3TMAAAAAElFTkSuQmCC'>
                              <span class=spc></span>
                              <img class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAAsVBMVEVHcEwYHikfICYPFygKFCkNFikQFiYRGSsQFygtLTQ6NCkVHCkLFCkPFyoLFCkbICsOFykOFikOFyoOFysrKCUuMC0MFSobHCYLFSz7003/1k71nguYaBf91E34oAudiUHGgxPsx0xAOiv8oQpqYDewl0PiwEuPfj4rLCmLYRryzE1ZQh9OSjLnlg6BWxscICrOr0fFqUc+PDB4VRu3ehaFdjvDp0aydxbikw/NrkjdkRCt0DWNAAAAGXRSTlMACOzCLCgKGcgB/tufP1jm67lrf/z9qQOBZilVbQAAAOZJREFUKM+t09kSgiAYhmFyQzGybBW1rKw00/b1/i8sE2ocSE/qOX1nPv8DBOBnDa3Q+Bo1u6MX5C4Uq9HtZV4hRk1NyND0xkzQs4WsSMHYZWITKxT8ltNEYvSWIWb3FjCZhMuZfX3+5iajUk6vHgcN4Cc/kujA6+v4nTO0n/KWYUejOUUr4vPIxVJpPkV34vDIwoQ0HzdrX8hO2DSKfMq3hegvUYueFkc7v2o7z7PN2qnaBkp7W7P9yrvKu1+55m4A1HbdNlCtS812/pgmRPDZzp9i/zzhhRYuPWSZN8Dib1AyBP/wBOetOMZSfFbQAAAAAElFTkSuQmCC'>
                              <span class=dir-name></span>
                        </div>
                        <div class=dir-list>
                              <div class=file>
                                    <div style='width:17px'></div>
                                    <span class=spc></span>
                                    <img class=icon src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAAUVBMVEVHcExMlMpNlctNlctNlctNlctNlctLk8lNlctNlctNlctNlctNlctKkcdNlcs4e69MlMpNlctNlcs1d6xNlctNlctNlctNlctIj8U2ea09gbbbwywCAAAAF3RSTlMAAab5LVnwa1ANgM6yROXooNC9UscUeiO0JQUAAACZSURBVCjPvdLbEsMQEIDhdYjQlIgmRd7/QXvRGV2W9Kr9bv/BMgB+j8mpIlmVtYsVp6vsY8NXe/OoFkRFzuocDlMcgWR3QxzJjTZvky6mjeRdIjvJQiGCjnZH6GjBsMJ0LsYRuloU3YuVyWfRy4u2b89ujtebf3lULKXkx/nMebUwyunM6wNGnymls62gFTqXVGB2/rAM/uIFg2QWsl/b0uIAAAAASUVORK5CYII='>
                                    <span class=file-name></span>
                              </div>
                        </div>
                  </div>
                  
            </div>
            
      </template>
      
      
      <script>
      
(function({mod,dom,host}){

  var obj   = {
        version   : 'v1.0',
  };
  
      var df=true,did='dir-tree'
      ;
      
      
      
      obj.initmod   = function(params){
      }//initmod
      
      
  //vars:
  
  
      var tree;
      var dir;
      var file;
      
      
  //:
  
  
      obj.init    = function(){
      }//init
      
      
  //:
  
  
        obj.initdom   = function(){
        
              var shadow                  = host.shadowRoot;
              
              
              tree                        = $(shadow,'#tree');
              tree.style.visibility       = '';
              
              dir                         = $(shadow,'.dir');
              dir.remove();
              
              file                        = $(dir,'.file');
              file.remove();
              
              
        }//initdom
        
        
  //:
  
  
      var cur;
      
      var index   = 0;
      var cols    = ['rgba(173,216,230,0.15)','rgba(211,211,211,0.15)'];
      
      
  //:
  
  
  
  
      obj.build   = function(data){return build(data)}
      
      function build(data,par=null){
      
            var data2   = [];
            
            for(var key in data){
            
                  var v       = data[key];
                  var type    = datatype(v);
                  if(type=='object'){
                        var d       = {type:'dir',name:key,parent:par}
                        var o       = build(v,d);
                        d.list      = o;
                        data2.push(d);
                  }else{
                        data2.push({type:'file',name:key,parent:par});
                  }
                  
            }//for
            
            return data2;
            
      }//build
      
      
      function depth(o){
      
            var c   = 0;
            while(o){
            
                  c++;
                  o   = o.parent;
                  
            }//while
            return c-1;
            
      }//depth
      
      
      obj.display   = function(data,options){return display(data,null,options)}
      
      function display(data,par,options){
      
            if(!par){
                  cur     = data;
                  par     = tree;
                  index   = 0;
            }
            
            var list    = $(par,'.dir-list')||par;
            
            var n   = data.length;
            for(var i=0;i<n;i++){
            
            
                  let o         = data[i];
                  var indent    = depth(o);
                  index++;
                                                                                console.log(index,o.name,indent);
                                                                                
                  if(o.type=='file'){
                        let nfile                           = file.cloneNode(true);
                        o.node                              = nfile;
                        nfile.onclick                       = e=>click_file(nfile,o);
                        $(nfile,'.spc').style.width         = indent*30+'px';
                        nfile.style.background              = cols[index%2];
                        $(nfile,'.file-name').textContent   = o.name;
                        highlight(nfile);
                        list.append(nfile);
                  }
                  
                  if(o.type=='dir'){
                        let ndir                          = dir.cloneNode(true);
                        o.node                            = ndir;
                        var hdr                           = $(ndir,'.dir-hdr');
                        $(ndir,'.dir-hdr').onclick        = e=>click_dir(ndir,o);
                        hdr.style.background              = cols[index%2];
                        $(ndir,'.spc').style.width        = indent*30+'px';
                        $(ndir,'.dir-name').textContent   = o.name;
                        highlight($(ndir,'.dir-hdr'));
                        list.append(ndir);
                        display(o.list,ndir,options);
                  }
                  
            }//for
            
            
            function highlight(node){
            
                  var prev;
                  node.onmouseenter   = e=>(prev=node.style.background,node.style.background='lightyellow');
                  node.onmouseleave   = e=>node.style.background=prev;
                  
            }//hightlight
            
            
            function click_dir(ndir,o){
            
                  if($(hdr,'.expand').classList.contains('close')){
                        open(ndir);
                        return;
                  }
                  
                  close(ndir);
                  
            }//click
            
            
            function click_file(nfile,o){
            
                  options?.callback?.file(o.name,o);
                  
            }//click_file
            
      }//display
      
      
      function open(ndir){
      
            var hdr   = $(ndir,'.dir-hdr');
            $(hdr,'.expand').classList.remove('close');
            hdr.parentNode.style.maxHeight    = '';
            
      }//open
      
      
      function close(ndir){
      
            var hdr   = $(ndir,'.dir-hdr');
            $(hdr,'.expand').classList.add('close');
            hdr.parentNode.style.maxHeight    = '40px';
            
      }//close
      
      
/*
              var data    = [
                    {
                          parent    : null,
                          type      : 'dir',
                          name      : 'tmp',
                          list      : [
                                {
                                      parent    : {object},
                                      type      : 'dir',
                                      name      : 'tmp-1',
                                      list      : [
                                            {
                                                  parent    : 'object',
                                                  type      : 'file',
                                                  name      : 'test.txt'
                                            }
                                      ]
                                },
                                {
                                      parent    : {object},
                                      type      : 'file',
                                      name      : 'hello.txt'
                                }
                          ]
                    }
              ];
*/


      function find(path){
      
            var parts   = path.split('/').filter(Boolean);
            var o       = cur.find(o=>o.name===parts[0]);
            var n       = parts.length;
            for(var i=1;i<n;i++){
            
                  o   = o.list.find(o=>o.name===parts[i]);
                  
            }//for
            return o;
            
      }//find
      
      
      obj.open    = function(path){
      
            var o   = find(path);
            open(o.node);
            
      }//open
      
      
      obj.close   = function(path){
      
            var o   = find(path);
            close(o.node);
            
      }//close
      
      
  //:
  
  
        function $(root,css){return (!css && (css=root,root=host.shadowRoot),root.querySelector(css))}
        function datatype(v){return Object.prototype.toString.call(v).slice(8,-1).toLowerCase()}
        
        
  //:
  
  
        function debug(...args){
        
              if(!df && !obj.df)return;
              args.unshift(`[ ${did} ]`);
              var fmt     = Array.from({length:args.length}).fill('%O').join(' ');
              var args2   = [fmt].concat(args);
              console.groupCollapsed.apply(console,args2);
              console.trace();
              console.groupEnd();
              
        }//debug
        
        
        
  return obj;
  
//dir-tree
})

      </script>
      
</dir-tree>


