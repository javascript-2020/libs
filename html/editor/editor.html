

<editor-root>

      <template shadowrootmode=open>
      
            <script src='https://cdn.jsdelivr.net/npm/ace-builds@1.37.0/src-min-noconflict/ace.js'></script>
      
            <style>

                  #root {display:flex;flex-direction:column}
                  
                  #hdr {display:flex}
                  
                  #filename-root {flex:1;display:flex;align-content:center}
                  #filename-icon {width:20px;height:20px;margin-right:5px;
                                  content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAP1BMVEVHcEwVFRUICAgkJCQMDAwLCwsNDQ1QUFAICAgrKysQEBAVFRUHBwcLCwsZGRkKCgoHBwfd3d0ICAgkJCQEBATHNF52AAAAFXRSTlMAQ9IblZl1BbQOXDbHiiWj1wG2H/ZbTuAhAAAA5klEQVQ4y72V2w6DIAxAKQjIRRT1/791gkg226mJc+elSE5qqYCMPQV0zY4uUF7grdwxc0cl5NNuxvjBO0oUuxnhbUPkxKLxYCQ2yYzMSPT2LMbCmpFbRphJtH0B0ozu/TJsZy+QCF1hTTKpNG4GOKlxK5XfEKNOsBIzkRTt2C5AVDkmRkuKTiUCA1Vx92q8LDqFcAeLeefLYt7actyeyzUKVwnM5ChIUQ2VJgJPUZGiCZXtwdyrURuEpvvoEXQfg0XQX0b/fFN84PIxgwuiTAfX/mXjTtdE4iJdaXk4u5rLBQ2P/Q1eGdEQZZzIbegAAAAASUVORK5CYII=)
                                }
                  #filename-save {width:20px;height:20px;margin-right:5px;padding:2px;
                                  content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoBAMAAAB+0KVeAAAAKlBMVEX/pQD/////qhH/pAD/rhr/zHH/yGT/wlP//vz/8dn/tjD/+u//6MD/2ZUL9bZAAAAA30lEQVQoz2OQvuWihARUMgUFBRlamRkYlqXBQLoy10Sg4CUGBisgDQLSu3dLXGBeAxRczMBg3ggR3LZqaeMhBquDggzOCMFdxuZAQWYfQQYHuKDELgOQINA0JEFBqCDzSiwqGdiwqGRgYlDAVIksSIpKYyyC28E+ggoi/L5D8AJMkGFZKAyEKcAFjRGAAS6IBsCCzMbGKGpBgkwqLshAASzoOxMFHDEACjJXCKKANmyCYkNI0IEGgs7YBBdjCpowXGBejSq43YCVYSszV1ooEkgrMMhmkL6lhAIUlJZuBAAfSYTf2T2EkwAAAABJRU5ErkJggg==)
                                }
                  #filename {margin:5px 0;flex:1;margin-right:10px}


                  #row,#col {width:40px;text-align:center}
                  #row {margin-right:5px}
                  #col {margin-right:10px}
                  
                  #top,#bottom {width:20px;height:20px;border:1px solid dimgray;padding:2px;border-radius:3px;cursor:pointer;}
                  #top {  margin-right:5px;
                          content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAdCAMAAADvl95BAAAAS1BMVEVHcEwPDikfO2MkR3MQES0OCyMnTnsPDyoODCYiQWwGAQgdNVsdNFsOCiIpVYUNCiFLsv5LtP9FouhHpu1EnuJCmdxAlNY/kNBJrve1TSxXAAAAEHRSTlMAV+PvbkDxYkzsAdXeMvYjWjmjswAAANtJREFUOMul1O0WRCAQBuBI2wehEPd/pVvZmCjbnvVP53Gapncg9MczDGWOtC0pc+vaFUjSGaUKJKmNGsfvknnnJXt2i3dWmid5OidrVuKeZMWhs3Kpq7SbI5eTd+ckv8kKn27b8pJiHZya+n46XmZOs+7VNBkp6CtyQkQSU/FxDXDaOrcEpMaNyDi/yVVad/84JSmGC6Ecd0C4ke0SCIwtO2rtIZVxwxHktWWn3F0Iq3WJ69I+7mHYXPxTbr9Y6yQYlIUnI8XwDJwbvXT0XF3QISRlLvZy+PE/8wZTOhuNMbwXWAAAAABJRU5ErkJggg==)
                      }
                  #bottom {  transform:rotate(180deg);
                          content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAdCAMAAADvl95BAAAAS1BMVEVHcEwPDikfO2MkR3MQES0OCyMnTnsPDyoODCYiQWwGAQgdNVsdNFsOCiIpVYUNCiFLsv5LtP9FouhHpu1EnuJCmdxAlNY/kNBJrve1TSxXAAAAEHRSTlMAV+PvbkDxYkzsAdXeMvYjWjmjswAAANtJREFUOMul1O0WRCAQBuBI2wehEPd/pVvZmCjbnvVP53Gapncg9MczDGWOtC0pc+vaFUjSGaUKJKmNGsfvknnnJXt2i3dWmid5OidrVuKeZMWhs3Kpq7SbI5eTd+ckv8kKn27b8pJiHZya+n46XmZOs+7VNBkp6CtyQkQSU/FxDXDaOrcEpMaNyDi/yVVad/84JSmGC6Ecd0C4ke0SCIwtO2rtIZVxwxHktWWn3F0Iq3WJ69I+7mHYXPxTbr9Y6yQYlIUnI8XwDJwbvXT0XF3QISRlLvZy+PE/8wZTOhuNMbwXWAAAAABJRU5ErkJggg==)
                      }
            
                  #editor {flex:1}
                  
            </style>
            
            <div id=root>
            
                  <div id=hdr>
                        <div id=filename-root>
                              <img id=filename-icon>
                              <img id=filename-save style='display:none'>
                              <span id=filename>filename</span>
                        </div>
                        <input id=row value=0>
                        <input id=col value=0>
                        <img id=top>
                        <img id=bottom>
                  </div>
                  
                  <div id=editor></div>
                  
            </div>
            
      </template>
      
      <script>
      
            editor    = editor();
            
            function editor(){
            
              var obj   = {};

                  
                  var root;
                  var shadow;
                  
                  var deficon;
                  var row;
                  var col;
                  
                  var kd    = {};
                  var btn   = {};
                  
                  
                  obj.initdom=function(){
                  
                        root                          = $('editor-root');
                        shadow                        = root.shadowRoot;


                        fn();
                        
                        

                        var hdr                       = $(shadow,'#hdr');
                        
                        deficon                       = $(hdr,'#filename-icon').src;
                        
                        row                           = $(hdr,'#row');
                        row.onkeydown                 = kd.row;
                        row.onmousedown               = e=>e.target.select();
                        col                           = $(hdr,'#col');
                        col.onkeydown                 = kd.col;
                        col.onmousedown               = e=>e.target.select();
                        
                        $(hdr,'#top').onclick         = btn.top;
                        $(hdr,'#bottom').onclick      = btn.bottom;


                        setup(shadow);

                        
                  }//initdom

                  
                  var ct=0;
                  function fn(){
                  
                        ct++;
                        if(ct>=10){
                              console.log('timeout');
                              return;
                        }
                        
                        //'ace_searchbox','error_marker.css',
                        var ids   = ['ace-tm','ace_editor.css','ace_scrollbar.css'];
                        var n     = ids.length;
                        for(var i=0;i<n;i++){
                        
                              var id    = ids[i];
                              console.log(id);
                        
                              var style   = document.head.querySelector('#'+id);
                              if(!style){
                                    setTimeout(fn,500);
                                    return;
                              }
                              
                              var copy    = style.cloneNode(true);
                              shadow.append(copy);
                              
                        }//for
                        
                  }//style
                  
                  
                  kd.row=function(e){
                        
                        if(e.key=='Enter'){
                              e.preventDefault();
                              var pos   = editor.getCursorPosition();
                              var r     = row.value;
                              var col   = pos.column;
                              editor.gotoLine(r,col);
                              editor.focus();
                        }
                        
                  }//row
          
                  
                  kd.col=function(e){
                        
                        if(e.key=='Enter'){
                              e.preventDefault();
                              var pos   = editor.getCursorPosition();
                              var row   = pos.row;
                              var c     = col.value;
                              editor.gotoLine(row,c);
                              editor.focus();
                        }
                        
                  }//col


                  btn.top=function(){
                  
                        editor.gotoLine(0,0);
                        editor.focus();
                        
                  }//top
          
                  
                  btn.bottom=function(){
                  
                        editor.gotoLine(999999,0);
                        editor.focus();
                        
                  }//bottom



                  obj.filename=filename;
                  
                  function filename(path,icon){console.log(icon);
          
                        icon                      = icon||deficon;
                        $('#filename-icon').src   = icon;
                        
                        var fn    = '';
                        if(path){
                              var i   = path.lastIndexOf('/');
                              if(i==-1){
                                    fn    = path;
                              }else{
                                    fn    = path.slice(i+1);
                              }
                        }
                        
                        document.title                = fn||'html-editor';
                        $('#filename').textContent    = fn;
                        $('#filename').title          = path||'';
                        return fn;
          
                  }//filename
          
          
                  filename.getname=function(path){
                  
                        var name;
                        var i   = path.lastIndexOf('/');
                        if(i==-1){
                              name    = path;
                        }else{
                              name    = path.slice(i+1);
                        }
                      
                  }//getname
                  
                  
                  filename.save=function(status){
          
                        var display   = '';
                        if(!status){
                              display   = 'none';
                        }
                        $('#filename-save').style.display   = display;
          
                  }//save
                  
          
                  function setup(root){
          
                        var node    = $(root,'#editor');
                        node.addEventListener('mousedown',update);
                        node.addEventListener('keydown',update);
                        
                        editor      = ace.edit(node);
                        editor.setShowInvisibles(false);
                        editor.setShowPrintMargin(false);
                        editor.setPrintMarginColumn(false);
                        editor.setBehavioursEnabled(false);
                        editor.setDisplayIndentGuides(false);
                        editor.setScrollSpeed(2);
                        editor.setFontSize(16);
                        editor.session.setOptions({tabSize:2,useSoftTabs:true});
                        //editor.setGhostText('\n\nctrl-enter - run & autosave\nctrl-s - save\nctrl-del - delete');
                        editor.focus();
                        editor.session.on('change',onchange);
                        
                        
                        function onchange(e){
          
                              filename.save(true);
                              update();
                                                
                        }//onchange
                        
                        function update(){
                        
                              var pos     = editor.getCursorPosition();
                              row.value   = pos.row+1;
                              col.value   = pos.column;
                              
                        }//update
                        
                  }//editor
          


  //:
  
                  obj.setValue=function(txt){return set(txt)}
                  
                  obj.set=function(txt){return set(txt)}
                  
                  function set(txt){
                  
                        editor.setValue(txt,-1);
                        
                  }//set
                  
              
                  obj.getValue=function(){return get()}
                  
                  obj.get=function(){return get()}
                  
                  function get(){
                  
                        var txt   = editor.getValue();
                        return txt;
                        
                  }//get
                  

                  obj.focus=function(){
                  
                        editor.focus();
                        
                  }//focus


                  obj.resize=function(){
                  
                        editor.resize();
                        
                  }//resize
                  
                  

                  
              return obj;
              
            }//editor
            
      </script>

</editor-root>

