


<file-nav>

      <template shadowrootmode=open>

            <style>

            
    #root
          {position:relative;display:flex;flex-direction:column;width:100%;height:100%}
    
    
    #path
          {padding:3px 5px}
    #view
          {flex:1;display:flex;border-top:1px solid lightgray}
    
    .scroll
          {height:5px;background:transparent;position:absolute;left:0;right:0}
          
    #empty
          {color:lightgray;font-weight:bold;opacity:0.65;text-align:center;cursor:default}
    
          
    #dir-root
          {padding:5px;flex:1;display:flex;flex-direction:column;border-right:1px solid lightgray}
    #dir-hdr
          {font-size:14px;display:flex;height:18px}
    #parent
          {cursor:pointer;width:18px;height:18px;
            content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAADAFBMVEVHcEwmAABSGQEYDQT65XL66XyRRgX532ZKrycHJAiDOAGSSQVJIwT611L35ntAHAN6QAfw2WxoMgSgZAkVBQGrbh+7hCxfLAeQVAiZXAfDkTSYUgrWr0v02WO2eR2iZAqtbxq8fgtTIARzPgbEih6pawqeYgqHTwi2eAs6lyEXWxUqdBqoZRPJkSTGixemZBfhvVFCpCTwzEz12GDyxz7ouTXlymanawrLkAmydRf442+mYBXJnUKydwOJTgjcrTS/hAi7iDGsbAanagWRVQhiMAZQJgXUmBtlNgYtgB13Qwe6ehBhMwaCSwcyiB7fqCTEjBDKnULas0w2jx+xdgmzeigwhB4pehvHjSL2yj3y01qeWQ6qZxHy0VXtxUXaqDNliyjw1GEfaRiISwjWois/kyHy3XLYpie9hARffR/03W/asEXSq03ZtVGenkDrxUZpOAb8wRhMtif62lj73Fz7yCz7wh770ED742756oH7xCP7yjH62FP7wyD71k764Gb71En63WD77ILY11nZ2mB060L7xyn7zjr2xzD74mr66HrXzUH7zDb7xif7xSVNuSj5vRXChwr65nfX0EfZ1FH65XP732PythJo2zpy6EBv5T9QvCn7wBb60kVl1zjaqxxfzjT66n77wRtj0zbZ3WL33WPhwjLY0kvX00/PlQvX1VZSvytVwi1byjK5wllYxi/vzEdq3zzipQ/12l/l1mPMkxVt4z7GjBH232vuxTLz0Uvmuy1LqSj15XyRrEL3zTxWwDDt1Vn311bntx/ksCvtwz3Xog3WpR1s4T1erTTmqRDZ4GhXxS/uvSTSnAnjrhDd0ELdyzzWxzv10EbYykDly0Q6lh321FHdtSfLlSJDmyR1qzqbtUrs0mhztSzgtkDl3HKrjxbUtS1syTTXmg6YlRuLmiDdzUnFmBthtzTQnCnTwjXUxDfa0kTbxjjsyDritDvR0WxWmSx2ojzl0FBUlSq8khXMw0zlw1WRjCG3ewVoqTjQzmPUyGODs0HBpj7eJVNyAAAAcXRSTlMAAQ0Jy8sgzP4FFSxAzM4jPP4RzRx0qx9th7476t+TpIHwFnfM1r+i6doaTGPS3l3S8ejR9ej+sf2i01LJ217+87L1w65NL+5sf4jHaJuk7u/B0LnPhItovNT5R2nc0tHX8TJQ6sza+/Hf/v7n8/rqRyeBn6oAAANzSURBVDjLY2AYBUQCTi1m4tSFaQZ7amsxQnhC3EyYSpi59UNFubU5+os4DDX9wpOE2KzlbHIcudGUcYlK5ZgJ3s1JOFAEBhyGqZl5f/cuFHRENVNIzGxvExDsvT0bpKx/9uoz688cOLmuqytXGkWhwo+mSiBoenCyH6xszfq1CxafOfln0tS7CigWqyytBCv8uKcfpmzejMW/t1RU7JAC283JxQbyoJLKdaCyhQsXrtsDV7Zx28wZ/wQ7O2W4GbikYyx1dXWAKjktj05auLCrq+vOntX9HEULQMpmzWxtXXBn2uZseTmVFFMjWSsbNqCRdulLgcomTfp87danr9c45p0AKZs5c9vL/69e2efLWrECQSBIIb/erkmTpk6dum7fui1b9t1aM6sVqG7WicXPXhxdKsgHUsZqIAoObfPdFVOnVoBAZ+fSfRwzQMo2Pn56/PmOSVlprCwsLOxiXGB/SxzfDFJTX18/bdq0g7fXbtu2cd69h/OnnH5QsUMWqI4lyBoSQAIBGzrBihobS0pKvr+c8fjes283mk8vadlRn8jOzm4sJgRRqBSyG6QIqKq4+NCG+z+fPnzx6ErLkpaW5s2NUcbs7Ab6sFQjP7+4BKSq+ND9m9u3Hn/0vBmsrHnVweLrsby8UmywyJFYuQuoqqamxn7i/A2HlracBqtaNWXFl5rrRrxxiIgUcNhZU1NXV/dh4o3N9dMatyxpXjVlyooVyydfbZhrwhsfDVcobnu4rq6h4ejE44dADj3YPGXF8uWTJ0/uvlpebhIZwYVIt+bz586dW35z5YYSkAt2TQGq6gaCS+/bezpM5RgRKUjy3P7y8iMTd4Md0HD5wtvu7iuX3rxeVl1d3eavg5TU7Cw62qu3H7sMtB9o8v6LFy6+W7Zs2c6O0rbeXnfk1CuQcbb9yMSzDXPLy8vb23ve79zZAVTU1ttXVVWrx4akEOibju3H9oMU9fRUV5eWlkIUlZUtmuAthKSQyfn8kYmH20GKqpEUAUHhJklG5Bwtf2zruQ6EIoiqwjkTpj9RE0fJYJIWE8+DFPUhK9pkoaHmxY+atSV+bT+LrkjY14dHhBOtDEh2OreoFqbo1EpFYXUPHhFsBZGA03kkRcpARYzYyycl501ARU8cVF2UefhxKQKDAlVFoCJXfiZGAkUeo5urG35FAEOJtiAMnazfAAAAAElFTkSuQmCC);
          }
    #dir-list
          {flex:1;overflow:auto;position:relative}
    .dir
          {padding:5px 10px;cursor:pointer;user-select:none;white-space:nowrap}
    
    #slider
          {background:lightblue;width:10px;cursor:ew-resize}
          
    #file-root
          {padding:5px;flex:1;display:flex;flex-direction:column}
    #file-hdr
          {font-size:14px;height:18px}
    #file-list
          {flex:1;position:relative;overflow:auto}
    .file
          {padding:5px 10px;cursor:pointer;user-select:none;white-space:nowrap}
    
          
    .spc
          {flex:1}

            
            </style>
            

            <div id=root>

                  <div id=path>
                  </div path>
                  
                  <div id=view>
                  
                        <div id=dir-root>
                        
                              <div id=dir-hdr>
                                    dirs
                                    <span id=dir-num>
                                          0
                                    </span>
                                    <span class=spc></span>
                                    <img id=parent>
                              </div>
                              
                              <div id=dir-list>
                                    <div class=dir>
                                          <div class=name>
                                          </div>
                                    </div>
                                    <div id=empty>
                                          empty
                                    </div>
                              </div>
                              
                        </div dir-root>
      
                        <div id=slider></slider>
                        
                        <div id=file-root>
                        
                              <div id=file-hdr>
                                    files
                                    <span id=file-num>
                                          0
                                    </span>
                              </div>
                              
                              <div id=file-list>
                                    <div class=file>
                                          <div class=name>
                                          </div>
                                    </div>
                              </div>
                              
                        </div file-root>
                        
                  </div view>

                  
            </div root>

      
      </template>

      <script>
                                                                                //console.log('mod.filenav');    
mod.filenav   = function(){
                                                                                debug('mod');  
  var obj   = {};
  
        var df=true
        ;
        Object.defineProperty(obj,'df',{set(v){df=v}});

        
  //modvars:-
  
        var click,dblclick
        ;
        
        obj.initmod   = function(params){
                                                                                debug('initmod');
              click       = params.click;
              dblclick    = params.dblclick;
              
        }//initmod
        
        
  //vars:-
    
        var root;
        
        var ui              = {};
        
        ui.dir              = {};
        ui.dir.root         = null;
        ui.dir.list         = null;
        ui.dir.item         = null;
        
        ui.file             = {};
        ui.file.root        = null;
        ui.file.list        = null;
        ui.file.item        = null;
        
        
  //
  
  
        obj.init    = function(){
                                                                                debug('init');
        }//init
        
        
  //:
  
  
        obj.initdom   = function(rootnode){
                                                                                debug('initdom');
              root                = $.$(rootnode,'file-nav');
              shadow              = root.shadowRoot;
              
              ui.path             = $(shadow,'#path');
              
              ui.dir.root         = $(shadow,'#dir-root');
              ui.dir.num          = $(ui.dir.root,'#dir-num');
              ui.dir.list         = $(ui.dir.root,'#dir-list');
              ui.dir.item         = $(ui.dir.list,'.dir');
              ui.dir.item.remove();
              
              ui.empty            = $(ui.dir.list,'#empty');
              ui.empty.remove();
              
              ui.file.root        = $(shadow,'#file-root');
              ui.file.num         = $(ui.file.root,'#file-num');
              ui.file.list        = $(ui.file.root,'#file-list');
              ui.file.item        = $(ui.file.list,'.file');
              ui.file.item.remove();
              
              
        }//initdom
        
        
  //:
  
  
  
        display.clear   = function(){

              ui.path.replaceChildren();
              
              ui.dir.root.replaceChildren();
              ui.file.root.replaceChildren();
              
              display.node.dir    = {};
              display.node.file   = {};
                            
        }//clear
        
        
        display.scroll        = {};
        display.node          = {};
        display.node.dir      = {};
        display.node.file     = {};

        
        obj.display   = function(path,dirs,files){
                                                                                //console.json(dirs);
                                                                                //console.json(files);
              $(ui.path).textContent    = path;
              
              display(path,'dir',dirs);
              display(path,'file',files);
              
        }//display

        
        function display(path,name,list){
                                                                                debug('display');
              var ih    = 25;
              var pad   = 5;
              
              var n     = list.length;
              var ns    = n;
              if(ns==0){
                    ns    = 1;
              }
              var t     = ns*ih;

              
              var evt   = {};
              
              
              ui[name].list.onscroll    = onscroll;


              ui[name].num.textContent    = n;
              

              var node    = display.scroll[name];
              if(!node){
                    node                    = document.createElement('div');
                    node.className          = 'scroll';
                    display.scroll[name]    = node;
                    ui[name].list.append(node);
              }
              node.style.top   = t+'px';


              var st    = ui[name].list.scrollTop;

              if(n==0){
                    var nempty    = ui.empty.cloneNode(true);
                    ui[name].list.append(nempty);
              }

              
              var i1    = Math.floor(st/ih)-3;
              if(i1<0){
                    i1    = 0;
              }
              
              var h     = ui[name].list.offsetHeight;
              var nh    = Math.floor(h/ih)+3;
              
              var i2    = i1+nh;
              if(i2>list.length){
                    i2    = list.length;
              }

        
              for(var key in display.node[name]){
                
                    if(key<i1 || key>=i2){
                          display.node[name][key].remove();
                          delete display.node[name][key];
                    }
                    
              }//for
                          

              for(let i=i1;i<i2;i++){
                
                    if(!display.node[name][i]){
                          let nitem                       = ui[name].item.cloneNode(true);
                          let filename                    = list[i];
                          $(nitem,'.name').textContent    = filename;
                          nitem.style.cssText             = 'position:absolute;left:0;right:0';
                          nitem.style.top                 = i*ih+'px';
                          ui[name].list.append(nitem);
                          display.node[name][i]           = nitem;
                          
                          nitem.onmouseenter              = e=>nitem.style.background   = 'lightyellow';
                          nitem.onmouseleave              = e=>nitem.style.background   = '';
                          nitem.onclick                   = e=>evt.click(filename);
                          nitem.ondblclick                = e=>evt.dblclick(filename);
                    }
                    
              }//for
                                                                                //var nn    = Object.keys(display.node[name]).length;
                                                                                //debug(name,nn);
              evt.click   = function(filename){
                
                    if(name==='dirs'){
                          filename   += '/';
                    }
                                                                                debug('click',name,filename);
                    if(typeof click=='function'){
                          click(path,name,filename);
                    }
                    
              }//click
              
              
              evt.dblclick    = function(filename){

                    if(name==='dirs'){
                          filename   += '/';
                    }
                                                                                debug('dblclick',name,filename);
                    dblclick(path,name,filename);
                    
              }//dblclick
              
              
              function onscroll(e){
                                                                                //debug(name,'onscroll');
                    display(path,name,list);
                    
              }//onscroll
              
        }//display




  //:
  
  
        function debug(){
          
              if(!df){
                    return;
              }
              
              var str   = [...arguments].join(' ');
              console.log('[ file-nav ]',str);
              
        }//debug


        
        
  return obj;
  
}//filenav

      </script>

</file-nav>



