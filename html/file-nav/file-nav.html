


<file-nav>

      <template shadowrootmode=open>

            <style>

            
        #root
              {position:relative;display:flex;gap:10px;width:100%;height:100%}

              
        #dir-root
              {flex:1;display:flex;flex-direction:column;border:1px solid lightgray}
        #dir-hdr
              {font-size:12px;}
        #dir-list
              {flex:1;overflow:auto;position:relative}
        .dir
              {padding:5px 10px;cursor:pointer;user-select:none}

              
        #file-root
              {flex:1;display:flex;flex-direction:column;border:1px solid lightgray}
        #file-hdr
              {font-size:12px}
        #file-list
              {flex:1;position:relative;overflow:auto}
        .file
              {padding:5px 10px;cursor:pointer;user-select:none}

              
        .spc
              {flex:1}

            
            </style>
            

            <div id=root>

            
                  <div id=dir-root>
                  
                        <div id=dir-hdr>
                              dirs
                        </div>
                        
                        <div id=dir-list>
                              <div class=dir>
                                    <div class=name>
                                    </div>
                              </div>
                        </div>
                        
                  </div dir-root>

                  
                  <div id=file-root>
                  
                        <div id=file-hdr>
                              files
                        </div>
                        
                        <div id=file-list>
                              <div class=file>
                                    <div class=name>
                                    </div>
                              </div>
                        </div>
                        
                  </div file-root>

                  
            </div root>

      
      </template>

      <script>
                                                                                //console.log('mod.filenav');    
mod.filenav   = function(){
                                                                                debug('mod');  
  var obj   = {};
  
        var df=true
        ;
        Object.defineProperty(obj,'df',{set(v){df=v}});

        
  //modvars:-
  
        var click,dblclick
        ;
        
        obj.initmod   = function(params){
                                                                                debug('initmod');
              click       = params.click;
              dblclick    = params.dblclick;
              
        }//initmod
        
        
  //vars:-
    
        var root;
        
        var ui              = {};
        
        ui.dir              = {};
        ui.dir.root         = null;
        ui.dir.list         = null;
        ui.dir.item         = null;
        
        ui.file             = {};
        ui.file.root        = null;
        ui.file.list        = null;
        ui.file.item        = null;
        
        
  //
  
  
        obj.init    = function(){
                                                                                debug('init');
        }//init
        
        
  //:
  
  
        obj.initdom   = function(rootnode){
                                                                                debug('initdom');
              root            = $.$(rootnode,'file-nav');
              shadow          = root.shadowRoot;
              
              ui.dir.root     = $(shadow,'#dir-root');
              ui.dir.list     = $(ui.dir.root,'#dir-list');
              ui.dir.item     = $(ui.dir.list,'.dir');
              ui.dir.item.remove();
              
              ui.file.root    = $(shadow,'#file-root');
              ui.file.list    = $(ui.file.root,'#file-list');
              ui.file.item    = $(ui.file.list,'.file');
              ui.file.item.remove();
              
              
        }//initdom
        
        
  //:
  
  
  
        display.clear   = function(){

              ui.dir.root.replaceChildren();
              ui.file.root.replaceChildren();
              
              display.node.dir    = {};
              display.node.file   = {};
              
              
        }//clear
        
        
        display.scroll        = {};
        display.node          = {};
        display.node.dir      = {};
        display.node.file     = {};

        
        obj.display   = function(path,dirs,files){
                                                                                //console.json(dirs);
                                                                                //console.json(files);
              display(path,'dir',dirs);
              display(path,'file',files);
              
        }//display

        
        function display(path,name,list){
                                                                                debug('display');
              var ih    = 25;
              var pad   = 5;
              
              var n     = list.length;
              var t     = n*ih;
              
              var evt   = {};
              
              
              ui[name].list.onscroll    = onscroll;


              if(!display.scroll[name]){
                    display.scroll[name]                  = document.createElement('div');
                    display.scroll[name].style.cssText    = 'height:5px;background:lightblue;position:absolute;left:0;right:0';
                    ui[name].list.append(display.scroll[name]);
              }
              display.scroll[name].style.top   = t+'px';
              
              var st    = ui[name].list.scrollTop;
              var i1    = Math.floor(st/ih)-3;
              if(i1<0){
                    i1    = 0;
              }
              
              var h     = ui[name].list.offsetHeight;
              var nh    = Math.floor(h/ih)+3;
              
              var i2    = i1+nh;
              if(i2>list.length){
                    i2    = list.length;
              }
        
              for(var key in display.node[name]){
                
                    if(key<i1 || key>=i2){
                          display.node[name][key].remove();
                          delete display.node[name][key];
                    }
                    
              }//for
                          
              for(let i=i1;i<i2;i++){
                
                    if(!display.node[name][i]){
                          let nitem                       = ui[name].item.cloneNode(true);
                          let filename                    = list[i];
                          $(nitem,'.name').textContent    = filename;
                          nitem.style.cssText             = 'position:absolute;left:0;right:0';
                          nitem.style.top                 = i*ih+'px';
                          ui[name].list.append(nitem);
                          display.node[name][i]           = nitem;
                          
                          nitem.onmouseenter              = e=>nitem.style.background   = 'lightyellow';
                          nitem.onmouseleave              = e=>nitem.style.background   = '';
                          nitem.onclick                   = e=>evt.click(filename);
                          nitem.ondblclick                = e=>evt.dblclick(filename);
                    }
                    
              }//for
                                                                                var n   = Object.keys(display.node[name]).length;
                                                                                debug(name,n);
              evt.click   = function(filename){
                
                    if(name==='dirs'){
                          filename   += '/';
                    }
                                                                                debug('click',name,filename);
                    if(typeof click=='function'){
                          click(path,name,filename);
                    }
                    
              }//click
              
              
              evt.dblclick    = function(filename){

                    if(name==='dirs'){
                          filename   += '/';
                    }
                                                                                debug('dblclick',name,filename);
                    dblclick(path,name,filename);
                    
              }//dblclick
              
              
              function onscroll(e){
                                                                                debug(name,'onscroll');
                    display(name,list);
                    
              }//onscroll
              
        }//display




  //:
  
  
        function debug(){
          
              if(!df){
                    return;
              }
              
              var str   = [...arguments].join(' ');
              console.log('[ file-nav ]',str);
              
        }//debug


        
        
  return obj;
  
}//filenav

      </script>

</file-nav>



