


<file-nav>

      <template shadowrootmode=open>

            <style>

            
    #root
          {position:relative;display:flex;flex-direction:column;width:100%;height:100%}
    
    
    #path
          {padding:3px 5px}
    #view
          {flex:1;display:flex;border-top:1px solid lightgray}
    
    .scroll
          {height:5px;background:transparent;position:absolute;left:0;right:0}
          
    #empty
          {color:lightgray;font-weight:bold;opacity:0.65;text-align:center;cursor:default}
    
    .icon-add
          {cursor:pointer;width:16px;height:16px;
            content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAclBMVEVHcExR3EdQ3EZG1j1HyD9DszxF1zxX301W30xCvDpLy0JKvkJV3ktV3ktV3ktV3ks/sDk9vTZAzThHxD9R3EdBzThHyD9P20VM2kNL2UJY301N2kRE1jtU3kpa4FBJ2EBR3EdG1z1C1ThA1Dc+vzZEzjy4PAznAAAAF3RSTlMA8TPx8TQ08TSQIgPhlYsUFPHh4V40Xv/yAZ0AAADTSURBVDjLzdTZFoIgEIDhASoFF9yXLLXF93/FtEDweA5ypX2X43/HOABLPHDakRNwMPLCVgg9Y8h8GfrMGLqODB13I7wKB4R3Yf8QyRDtHWLUCwiv9oC5M5ypMMNqzsYN4aGPNP1Mn/ohh6C0EgCyCxGUlqCxZB/WTWWhqYFUtYWKAB0sumagENH0pJm/dfo0pdH0hGelIN1PTQptzFY/OZZhR7Bxey4qvGyED+GA8Cb8c/gUNsJchbn5NCcyTMyn2aPD62ug5mM/bl38HsXTXi18AGTaQkGdjU6xAAAAAElFTkSuQmCC);
          }
    .icon-rem
          {cursor:pointer;width:16px;height:16px;
            content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoBAMAAAB+0KVeAAAAG1BMVEVHcEz/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AACeYvHRAAAACHRSTlMAshvkTlvjTdJU7DIAAAC1SURBVCjPbdMxDoMwDAVQK2rVvRMjvkOHjkhcoFNvgFg7dUcsPnaJsbFLPtNX8gKJY4iIrnc6Hn5Z+C69j5Vu3sPlKQdlWQcNo4jT0ok8DIpT3qLSDTqtUOmtQqOscf3QW4PSHYpMZKFStrhE6kvMR4zptCi9KGiCQRM8Uz8xt/CfRhW5hZkGTDRdDByEy9GH4JbQ5uExUUFg6VCR4XXAi4NXDJsBtg1sMNyKsGlxe8Mfof1lfq62539imm/1AAAAAElFTkSuQmCC);
          }
          
    #dir-root
          {width:calc(50% - 5px)/*flex:1*/;padding:5px;display:flex;flex-direction:column;/*border-right:1px solid lightgray;*/
            box-sizing:border-box;overflow:hidden;
          }
    #dir-hdr
          {font-size:14px;display:flex;gap:10px;height:18px}
    #dir-add
          {}
    #dir-rem
          {}
    #parent
          {cursor:pointer;width:18px;height:18px;
            content:url(data:image/png;base64,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);
          }
    #dir-list
          {flex:1;overflow:auto;position:relative}
    .dir
          {padding:5px 10px;cursor:pointer;user-select:none;white-space:nowrap}

    
    #slider
          {width:10px;cursor:ew-resize;/*background:lightblue;*/}

          
    #file-root
          {flex:1;padding:5px;display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;border-left:1px solid lightgray}
    #file-hdr
          {font-size:14px;height:18px;display:flex;gap:10px}
    #file-list
          {flex:1;position:relative;overflow:auto}
    .file
          {padding:5px 10px;cursor:pointer;user-select:none;white-space:nowrap}
    
          
    .spc
          {flex:1}

            
            </style>
            

            <div id=root>

                  <div id=path>
                  </div path>
                  
                  <div id=view>
                  
                        <div id=dir-root>
                        
                              <div id=dir-hdr>
                                    dirs
                                    <span id=dir-num>
                                          0
                                    </span>
                                    <span class=spc></span>
                                    <img id=dir-add class=icon-add>
                                    <img id=dir-rem class=icon-rem>
                                    <img id=parent>
                              </div>
                              
                              <div id=dir-list>
                                    <div class=dir>
                                          <div class=name>
                                          </div>
                                    </div>
                                    <div id=empty>
                                          empty
                                    </div>
                              </div>
                              
                        </div dir-root>
      
                        <div id=slider></div>
                        
                        <div id=file-root>
                        
                              <div id=file-hdr>
                                    files
                                    <span id=file-num>
                                          0
                                    </span>
                                    <span class=spc></span>
                                    <img id=file-add class=icon-add>
                                    <img id=file-rem class=icon-rem>
                              </div>
                              
                              <div id=file-list>
                                    <div class=file>
                                          <div class=name>
                                          </div>
                                    </div>
                              </div>
                              
                        </div file-root>
                        
                  </div view>

                  
            </div root>

      
      </template>

      <script>
                                                                                //console.log('mod.filenav');    
mod.filenav   = function(){
                                                                                debug('mod');  
  var obj   = {};
  
        var df=true
        ;
        Object.defineProperty(obj,'df',{set(v){df=v}});

        
  //modvars:-
  
        var $,datatype
        ;
        
        obj.initmod   = function(params){
                                                                                debug('initmod');
              $           = params.$;
              datatype    = params.datatype;
              
        }//initmod
        
        
  //vars:-
    
        obj.file            = {};
        obj.dir             = {};

        
        var root;
        var shadow;
        
        var cur             = {};
        cur.item            = null;
        cur.file            = null;
        cur.type            = null;
        cur.set             = (item,file,type)=>{
          
                                    cur.item    = item;
                                    cur.file    = file;
                                    cur.type    = type;
                                    
                              }//set
        cur.rem             = ()=>{
                              
                                    cur.item    = null;
                                    cur.file    = null;
                                    cur.type    = null;
                                    
                              }//rem
        
        var ui              = {};
        
        ui.rd               = {};
        ui.rd.path          = ()=>$(ui.path).textContent.trim();
        
        ui.dir              = {};
        ui.dir.root         = null;
        ui.dir.list         = null;
        ui.dir.item         = null;
        
        ui.file             = {};
        ui.file.root        = null;
        ui.file.list        = null;
        ui.file.item        = null;
        
        
        var btn             = {};
        btn.file            = {};
        btn.dir             = {};
        
        
        
  //
  
  
        obj.init    = function(){
                                                                                debug('init');
        }//init
        
        
  //:
  
  
        obj.initdom   = function(rootnode){
                                                                                debug('initdom');
              root                                      = $.$(rootnode,'file-nav');
              shadow                                    = root.shadowRoot;
              
              ui.path                                   = $(shadow,'#path');
              
              var view                                  = $(shadow,'#view');
              
              ui.dir.root                               = $(shadow,'#dir-root');
              ui.dir.num                                = $(ui.dir.root,'#dir-num');
              $(ui.dir.root,'#dir-add').onclick         = btn.dir.add;
              $(ui.dir.root,'#dir-rem').onclick         = btn.dir.rem;
              $(ui.dir.root,'#parent').onclick          = btn.dir.parent;
              ui.dir.list                               = $(ui.dir.root,'#dir-list');
              ui.dir.item                               = $(ui.dir.list,'.dir');
              ui.dir.item.remove();
              var empty                                 = $(ui.dir.list,'#empty');
              empty.remove();
              ui.dir.empty                              = empty.cloneNode(true);
              
              ui.file.root                              = $(shadow,'#file-root');
              ui.file.num                               = $(ui.file.root,'#file-num');
              $(ui.file.root,'#file-add').onclick       = btn.file.add;
              $(ui.file.root,'#file-rem').onclick       = btn.file.rem;
              ui.file.list                              = $(ui.file.root,'#file-list');
              ui.file.item                              = $(ui.file.list,'.file');
              ui.file.item.remove();
              ui.file.empty                             = empty.cloneNode(true);
              
              $.slider(ui.dir.root,'#slider',ui.file.root,null,{root:view});
              
              
        }//initdom
        

  //:
  
  
        btn.file.add    = function(){
          
              var name    = window.prompt('enter file name');
              if(!name){
                    return;
              }
              var path    = ui.rd.path();
              callback('file','add',path,name);
              
        }//add
        
        
        btn.file.rem    = function(){
          
              if(!cur.type){
                    return;
              }
              if(cur.type!='file'){
                    return;
              }
              
              var path        = ui.rd.path();
              var filename    = cur.file;
              callback('file','rem',path,filename);
              
        }//rem
        
  
        btn.dir.add   = function(){
          
              var name    = window.prompt('enter dir name');
              if(!name){
                    return;
              }
              var path    = $(ui.path).textContent.trim();
              callback('dir','add',path,name);
              
        }//add

        
        btn.dir.rem   = function(){
          
              if(!cur.type){
                    return;
              }
              if(cur.type!='dir'){
                    return;
              }
              
              var path        = ui.rd.path();
              var filename    = cur.file;
              callback('dir','rem',path,filename);
              
        }//rem
        
        
        btn.dir.parent    = function(){
          
              var path    = $(ui.path).textContent.trim();
              path        = path.slice(0,-1);
                                                                                //console.log(path);
              var i       = path.lastIndexOf('/');
              if(i==-1){
                    return;
              }
              path        = path.slice(0,i+1);
                                                                                console.log('btn.dir.parent',path);
              callback('dir','parent',path);
              
        }//parent
        
        
  //:
  
  
  
        display.clear   = function(){

              ui.path.replaceChildren();
              
              ui.dir.list.replaceChildren();
              ui.file.list.replaceChildren();
              
              display.node.dir    = {};
              display.node.file   = {};
                            
        }//clear
        
        
        display.scroll        = {};
        display.node          = {};
        display.node.dir      = {};
        display.node.file     = {};

        
        obj.display   = function(path,dirs,files){
                                                                                debug('display',path);
                                                                                //console.json(dirs);
                                                                                //console.json(files);
              //display.clear();

              
              $(ui.path).textContent    = path;
              
              
              display(path,'dir',dirs);
              display(path,'file',files);
              
        }//display

        
        function display(path,name,list){
                                                                                //debug('display');
              var ih    = 25;
              var pad   = 5;
              
              var n     = list.length;
              var ns    = n;
              if(ns==0){
                    ns    = 1;
              }
              var t     = ns*ih;

              
              var evt   = {};
              
              obj.onscoll                 = onscroll;
              ui[name].list.onscroll      = onscroll;

              
              ui[name].num.textContent    = n;
              

              var node    = display.scroll[name];
              if(!node){
                    node                    = document.createElement('div');
                    node.className          = 'scroll';
                    display.scroll[name]    = node;
                    ui[name].list.append(node);
              }
              node.style.top   = t+'px';


              var st    = ui[name].list.scrollTop;

              if(n==0){
                    ui[name].list.append(ui[name].empty);
              }else{
                    ui[name].empty.remove();
              }

              
              var i1    = Math.floor(st/ih)-3;
              if(i1<0){
                    i1    = 0;
              }
              
              var h     = ui[name].list.offsetHeight;
              var nh    = Math.floor(h/ih)+3;
              
              var i2    = i1+nh;
              if(i2>list.length){
                    i2    = list.length;
              }

        
              for(var key in display.node[name]){
                
                    if(key<i1 || key>=i2){
                          display.node[name][key].remove();
                          delete display.node[name][key];
                    }
                    
              }//for
                          

              for(let i=i1;i<i2;i++){
                
                    let nitem       = display.node[name][i];
                    let filename    = list[i];
                    
                    if(!nitem){
                          nitem                           = ui[name].item.cloneNode(true);
                          nitem.style.cssText             = 'position:absolute;left:0;right:0';
                          nitem.style.top                 = i*ih+'px';
                          ui[name].list.append(nitem);
                          display.node[name][i]           = nitem;
                          
                          nitem.onmouseenter              = e=>evt.mouseenter(nitem);
                          nitem.onmouseleave              = e=>evt.mouseleave(nitem);
                    }
                    
                    $(nitem,'.name').textContent    = filename;
                    nitem.onclick                   = e=>evt.click(nitem,filename);
                    nitem.ondblclick                = e=>evt.dblclick(nitem,filename);
                    
              }//for
                                                                                //var nn    = Object.keys(display.node[name]).length;
                                                                                //debug(name,nn);
              evt.click   = function(item,filename){
                                                                                console.log('click',name,path);
                    var type    = 'file';
                    
                    if(cur.item!==item){
                          if(cur.item){
                                cur.item.style.background    = '';
                          }
                          item.style.background   = 'lightyellow';
                          cur.set(item,filename,name);
                    }else{
                          item.style.background   = '';
                          cur.rem();
                    }
                    
                    
                    if(name==='dir'){
                          type        = 'dir';
                          filename   += '/';
                    }
                                                                                debug('click',path,name,filename);
                    callback(type,'click',path,filename);
                    
              }//click
              
              
              evt.dblclick    = function(item,filename){

                    var type    = 'file';
                    if(name==='dir'){
                          type        = 'dir';
                          filename   += '/';
                    }
                                                                                debug('dblclick',path,name,filename);
                    callback(type,'dblclick',path,filename);
                    
              }//dblclick
              

              evt.mouseenter    = function(item){
                
                    if(cur.item){
                          return;
                    }
                    item.style.background   = 'lightyellow';
                    
              }//mouseenter
              
              
              evt.mouseleave    = function(item){
                
                    if(cur.item){
                          return;
                    }
                    item.style.background   = '';
                    
              }//mouseleave
              
              
              function onscroll(e){
                                                                                debug(name,'onscroll');
                    display(path,name,list);
                    
              }//onscroll
              
        }//display


        function callback(type,name,arg0){
                                                                                console.log('callback');
                                                                                console.json(arguments);
              var args    = [...arguments].slice(2);
              
              if(typeof(obj[type][name])=='function'){
                    obj[type][name].apply(null,args);
              }
              if(datatype(obj[type][name])=='array'){
                    obj[type][name].forEach(fn=>fn.apply(null,args));
              }
                    
        }//callback

  
  //:
  
  
        function debug(){
          
              if(!df){
                    return;
              }
              
              var str   = [...arguments].join(' ');
              console.log('[ file-nav ]',str);
              
        }//debug


        
        
  return obj;
  
}//filenav

      </script>

</file-nav>



