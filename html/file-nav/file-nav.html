


<file-nav>

      <template shadowrootmode=open>

            <style>

            
    #root
          {position:relative;display:flex;flex-direction:column;width:100%;height:100%}
    
    #path-root
          {display:flex;gap:10px;align-items:center;padding-left:5px}
    #update
          {content:url(data:image/png;base64,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)}
    #path
          {padding:3px 5px}
          
          
    #view
          {flex:1;display:flex;border-top:1px solid lightgray;position:relative}

    #new-file-root
          {position:absolute;top:5px;left:0;right:0;height:0;overflow:hidden;transition:0.5s ease-out;display:flex;flex-direction:column;
            box-sizing:border-box;background:white;z-index:1}
    #new-file-container
          {padding:5px;border-bottom:1px solid lightgray}
    #new-file-label
          {font-size:14px}
    #new-file-hldr
          {display:flex;gap:10px;align-items:center}
    #new-file
          {flex:1;padding:5px 10px;font-size:16px}
    .new-file-add
          {content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAMAAACKeiw+AAAAY1BMVEVHcEwG2A1Ky0trxWoH2A0O1BMjzicjzyZayloZ0BwW0Rqdx5o6yzwbzx4G2A0R1BYI2A4Z0h0c0CA0yzcezyEK1hExzTMZ0h4T0hgO0xMU0hkO0xIT0xgA2woC2goA3AoE2QvnMtB+AAAAHXRSTlMA+A0F9M5IVAh4gwIXc/2175JhIGznMbGdv67gwn+a0CMAAADzSURBVCjPnZPdsoMgDISN/IiCioq2tU3k/Z+yVKbH0xZ6UWa84ZvNxmQpip+PKnUeltXpJnNQLycgXuXququnbijT1AzwhU6r98ibDF1unoi3LE2lIPJZWs1ECHWa6nHGQBt2/L48hsOcJQo9qz86gHVPzlqOwfh89GzE0SWrIVTG3vxzazsMXirSDcmL5WVCAiPXoTIizW97GCFcdk3pHr4E7n1zF9pwg94GLfqz+hgE4POQmD4X39OOwmdTAaj4znHzTSo+KsqTpaN8xzBmshPll0wACvlwz4kLrVYKziabammpa/OhZ/V1NV9eDJtSfd0B50kTuCtFsl4AAAAASUVORK5CYII=)
          }
    .new-file-cancel
          {content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAByFBMVEVHcEyXHBSKNCuGFhB2HBidGxKeFAubGA+oIRebGhGhFgyZFQ2hFgyqFw2aFg2OFQ6yIBSWFAynHBGQFg8QEx/BIhOHFA6iFgyKFQ6lGhHFQDbBMCSQFQ2WEgrebmXELCDJPTDRNiqnGQ+tGg+JFQ6vGw+mGxCLFA2XFg2qGg+XFw6wGw/BHxOgFgy0GxDDJhmsHhOxHBC4JhuvGw6PFQ60HxKxJhtoDgilGxHCIBKWFAy4JBiCFQ+YEwunHhSPEw3PPTGPEwzJKBjLNymQEgvEJxitJBmyIRTSSDuRFA2ZFg6tGw/AJRe0KR2vHBGoIBWyHhKwHRGPEwy8IhR3HRrQRjq6HhDILR+KEgzLLyHbRTrAJBfZQDO7IhXHMCPNOy2xGA3NIhe4Fw2pFwzUKR6kFQutGAytFAu9GQ6wFQzBGxDHHRO+HRLaY1nOJxypEwuiEgrnhHyzFgzKQjbjeG+zGgziOC7FNimfFAvVWE7sU0rqi4PQTULNRzvcLiPdamHecmnfPjSXEwvxX1fZRDnupqG3GQ7WXFK5HRLFLyPTMSbZOC3oQTfAJBfDKBrrTELsoZryurXvrKfol5DpWE7hST7qWU/wtLDc0MhrAAAAYHRSTlMADgISBhz4Vwsj17bc+I9WIr2HRAFUO+YtNfnyUfr+2v74qbpGnWQnbeFf5f/v94ksrODKc0DDB5Pw1rcX9KGK8si21u6SvXP3ap6/pdvuFtpjob8D5c+xpL33qPljotE7/DO+AAACE0lEQVQoz22SZXfiQBiFh7IEdygtUqCydRfqpd51Y90ISRYLBGiBAMWlriv9ux1y2i2S+yXnPc+ZyX3vHcDd/rmzs77Z3gIaJdCuzYEfHddXN5e596OKesjRrlnPJ4Hl8uq6XC7/DqxrHbUnP38rGVQ8sJVIpVLhcDiVs49y7qBj+uOXP6UZtQYA4bI+Gw7v7XXksrvPeQxVbNr/Fe2qRWawGbf0AYgDBwnLAjQg+G7+W0ya+f9/xeHP6APZQGI/ffROMfbVmiyWFtpqbXL7XqQPEvu78bMP5nwyaZ3lNizZu2xIQ3wezF9cGLZtTSHYBibilvhx7DQ/wdcAFrW/PjqJnZ6cjTvYqEA1h8dix2R05A0LfdUzhGcy+GE0Gh2cbqK88aEgngn265xQk7wGKuwiURwPDnarJb+geuqtK56RKIoHX8oBaBVBLH1cd3NXxY+i6EhfdWB4/1hNtZ0VH8SHskfM2CrBMKxTcE8dKqfH5/eT4vsku3UY9nA9X+qCmJQ8tCAfJgiR8M60yAuxTzpQY2YKIYhZJrwWGRZxeTzOp7W72GQ0Maxmkta5Iy5XRdJbtylXTNPiqjsZ4fZGKtiThpza5mmED7+iKvYqG/sH8iVaCZ8mQlBuLyJvKsGxUjDB40iIclNKTnOFi6sFMQfMhygKMbI9APXGkhFMmUL0Wxsb1qwUxID7yaQUAlbxVjduAaXrgRqvSBD6AAAAAElFTkSuQmCC)
          }
    
    .scroll
          {height:5px;background:transparent;position:absolute;left:0;right:0}
          
    #empty
          {color:lightgray;font-weight:bold;opacity:0.65;text-align:center;cursor:default}
    
    .icon
          {cursor:pointer;width:15px;height:15px}
    .icon-add
          {content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAclBMVEVHcExR3EdQ3EZG1j1HyD9DszxF1zxX301W30xCvDpLy0JKvkJV3ktV3ktV3ktV3ks/sDk9vTZAzThHxD9R3EdBzThHyD9P20VM2kNL2UJY301N2kRE1jtU3kpa4FBJ2EBR3EdG1z1C1ThA1Dc+vzZEzjy4PAznAAAAF3RSTlMA8TPx8TQ08TSQIgPhlYsUFPHh4V40Xv/yAZ0AAADTSURBVDjLzdTZFoIgEIDhASoFF9yXLLXF93/FtEDweA5ypX2X43/HOABLPHDakRNwMPLCVgg9Y8h8GfrMGLqODB13I7wKB4R3Yf8QyRDtHWLUCwiv9oC5M5ypMMNqzsYN4aGPNP1Mn/ohh6C0EgCyCxGUlqCxZB/WTWWhqYFUtYWKAB0sumagENH0pJm/dfo0pdH0hGelIN1PTQptzFY/OZZhR7Bxey4qvGyED+GA8Cb8c/gUNsJchbn5NCcyTMyn2aPD62ug5mM/bl38HsXTXi18AGTaQkGdjU6xAAAAAElFTkSuQmCC);
          }
    .icon-rem
          {content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoBAMAAAB+0KVeAAAAG1BMVEVHcEz/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AACeYvHRAAAACHRSTlMAshvkTlvjTdJU7DIAAAC1SURBVCjPbdMxDoMwDAVQK2rVvRMjvkOHjkhcoFNvgFg7dUcsPnaJsbFLPtNX8gKJY4iIrnc6Hn5Z+C69j5Vu3sPlKQdlWQcNo4jT0ok8DIpT3qLSDTqtUOmtQqOscf3QW4PSHYpMZKFStrhE6kvMR4zptCi9KGiCQRM8Uz8xt/CfRhW5hZkGTDRdDByEy9GH4JbQ5uExUUFg6VCR4XXAi4NXDJsBtg1sMNyKsGlxe8Mfof1lfq62539imm/1AAAAAElFTkSuQmCC);
          }
          
    #dir-root
          {width:calc(50% - 5px);padding:5px;display:flex;flex-direction:column;
            box-sizing:border-box;overflow:hidden;
          }
    #dir-hdr
          {font-size:14px;display:flex;gap:10px;height:18px}
    #dir-add
          {}
    #dir-rem
          {}
    #parent
          {cursor:pointer;width:18px;height:18px;
            content:url(data:image/png;base64,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);
          }
    #dir-list
          {flex:1;overflow:auto;position:relative}
    .dir
          {padding:5px 10px;cursor:pointer;user-select:none;white-space:nowrap}

    
    #slider
          {width:10px;cursor:ew-resize;/*background:lightblue;*/}

          
    #file-root
          {flex:1;padding:5px;display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;border-left:1px solid lightgray}
    #file-hdr
          {font-size:14px;height:18px;display:flex;gap:10px}
    #file-list
          {flex:1;position:relative;overflow:auto}
    .file
          {padding:5px 10px;cursor:pointer;user-select:none;white-space:nowrap}
    
          
    .spc
          {flex:1}

            
            </style>
            

            <div id=root>

                  <div id=path-root>
                        <img id=update class='icon-update icon'>
                        <div id=path>
                        </div path>
                  </div>
                  
                  <div id=view>
                  
                        <div id=new-file-root>
                              <div id=new-file-container>
                                    <div id=new-file-label>
                                          new file
                                    </div>
                                    <div id=new-file-hldr>
                                          <input id=new-file>
                                          <img class='new-file-add icon'>
                                          <img class='new-file-cancel icon'>
                                    </div>
                              </div>
                        </div>
                  
                  
                        <div id=dir-root>
                        
                              <div id=dir-hdr>
                                    dirs
                                    <span id=dir-num>
                                          0
                                    </span>
                                    <span class=spc></span>
                                    <img id=dir-add class='icon-add icon'>
                                    <img id=dir-rem class='icon-rem icon'>
                                    <img id=parent>
                              </div>
                              
                              <div id=dir-list>
                                    <div class=dir>
                                          <div class=name>
                                          </div>
                                    </div>
                                    <div id=empty>
                                          empty
                                    </div>
                              </div>
                              
                        </div dir-root>
      
                        <div id=slider></div>
                        
                        <div id=file-root>
                        
                              <div id=file-hdr>
                                    files
                                    <span id=file-num>
                                          0
                                    </span>
                                    <span class=spc></span>
                                    <img id=file-add class='icon-add icon'>
                                    <img id=file-rem class='icon-rem icon'>
                              </div>
                              
                              <div id=file-list>
                                    <div class=file>
                                          <div class=name>
                                          </div>
                                    </div>
                              </div>
                              
                        </div file-root>
                        
                  </div view>

                  
            </div root>

      
      </template>

      <script>
                                                                                //console.log('mod.filenav');    
mod.filenav   = function(){
                                                                                debug('mod');  
  var obj   = {};
  
        var df=true
        ;
        Object.defineProperty(obj,'df',{set(v){df=v}});

        
  //modvars:-
  
        var $,datatype
        ;
        
        obj.initmod   = function(params){
                                                                                debug('initmod');
              $           = params.$;
              datatype    = params.datatype;
              
        }//initmod
        
        
  //vars:-

    
        var filenav         = obj;
    
        var newfile         = newfilemod();
        
        var def             = {};
        def.path            = '/';
        
        obj.rd              = {};
        obj.file            = {};
        obj.dir             = {};
        var file            = {};
        var dir             = {};
        var server          = {};
        obj.server          = server;
        
        Object.defineProperty(obj,'path',{set(v){ui.path.textContent    = v},get(){return ui.path.textContent.trim()}});
        
        var root;
        var shadow;
        
        var cur             = {};
        obj.cur             = cur;
        cur.type            = null;
        cur.item            = null;
        cur.path            = null;
        cur.file            = null;
        cur.set             = (type,item,path,file)=>{
          
                                    cur.type        = type;
                                    cur.item        = item;
                                    cur.path        = path;
                                    cur.filename    = file;
                                    
                              }//set
        cur.rem             = ()=>{
                              
                                    cur.type        = null;
                                    cur.item        = null;
                                    cur.path        = null;
                                    cur.filename    = null;
                                    
                              }//rem
        
        var ui              = {};
        
        ui.rd               = {};
        ui.rd.path          = ()=>$(ui.path).textContent.trim();
        
        ui.dir              = {};
        ui.dir.root         = null;
        ui.dir.list         = null;
        ui.dir.item         = null;
        
        ui.file             = {};
        ui.file.root        = null;
        ui.file.list        = null;
        ui.file.item        = null;
        
        
        var btn             = {};
        btn.file            = {};
        btn.dir             = {};
        
        
        
  //
  
  
        obj.init    = function(){
                                                                                debug('init');
              //newfile.initmod();
              newfile.init();
              
              
        }//init
        
        
  //:
  
  
        obj.initdom   = function(rootnode){
                                                                                debug('initdom');
              root                                      = $.$(rootnode,'file-nav');
              shadow                                    = root.shadowRoot;
              
              $(shadow,'#update').onclick               = btn.update;
              ui.path                                   = $(shadow,'#path');
              ui.path.textContent                       = def.path;
              
              newfile.initdom(shadow);
              
              var view                                  = $(shadow,'#view');
              
              ui.dir.root                               = $(shadow,'#dir-root');
              ui.dir.num                                = $(ui.dir.root,'#dir-num');
              $(ui.dir.root,'#dir-add').onclick         = btn.dir.add;
              $(ui.dir.root,'#dir-rem').onclick         = btn.dir.rem;
              $(ui.dir.root,'#parent').onclick          = btn.dir.parent;
              ui.dir.list                               = $(ui.dir.root,'#dir-list');
              ui.dir.item                               = $(ui.dir.list,'.dir');
              ui.dir.item.remove();
              var empty                                 = $(ui.dir.list,'#empty');
              empty.remove();
              ui.dir.empty                              = empty.cloneNode(true);
              
              ui.file.root                              = $(shadow,'#file-root');
              ui.file.num                               = $(ui.file.root,'#file-num');
              $(ui.file.root,'#file-add').onclick       = btn.file.add;
              $(ui.file.root,'#file-rem').onclick       = btn.file.rem;
              ui.file.list                              = $(ui.file.root,'#file-list');
              ui.file.item                              = $(ui.file.list,'.file');
              ui.file.item.remove();
              ui.file.empty                             = empty.cloneNode(true);
              
              $.slider(ui.dir.root,'#slider',ui.file.root,null,{root:view});
              
              
        }//initdom
        

  //:
  
  
        btn.update    = async function(){
          
              var path    = ui.rd.path();
              
              var result    = await callback('dir','read',path);
              if(result===false){
                    return;
              }
              var {url,auth}    = result;
              
              dir.read(url,auth,path);
              
        }//update
        
        
        btn.file.add    = async function(){
          
              var name    = await newfile.show();
              if(!name){
                    return;
              }
              
              var path      = ui.rd.path();
              
              var result    = await callback('file','add',path,name);
              if(result===false){
                    return;
              }
              var {url,auth}    = result;
              
              file.add(url,auth,path,name);
              
        }//add
        
        
        btn.file.rem    = async function(){
          
              if(!cur.type){
                    return;
              }
              if(cur.type!='file'){
                    return;
              }
              
              var path      = ui.rd.path();
              var name      = cur.filename;
              
              var result    = await callback('file','rem',path,name);
              if(result===false){
                    return;
              }
              var {url,auth}    = result;
              
              file.rem(url,auth,path,name);
              
        }//rem
        
  
        btn.dir.add   = async function(){

              var name    = await newfile.show();          
              if(!name){
                    return;
              }
              
              var path      = ui.rd.path();
              
              var result    = await callback('dir','add',path,name);
              if(result===false){
                    return;
              }
              var {url,auth}    = result;
              
              dir.add(url,auth,path,name);
              
        }//add

        
        btn.dir.rem   = async function(){
          
              if(!cur.type){
                    return;
              }
              if(cur.type!='dir'){
                    return;
              }
              
              var path      = ui.rd.path();
              var name      = cur.filename;
              
              var result    = await callback('dir','rem',path,name);
              if(result===false){
                    return;
              }
              var {url,auth}    = result;
              
              dir.rem(url,auth,path,name);
              
        }//rem
        
        
        btn.dir.parent    = async function(){
          
              var path    = ui.rd.path();
              path        = path.slice(0,-1);
                                                                                //console.log(path);
              var i       = path.lastIndexOf('/');
              if(i==-1){
                    return;
              }
              path        = path.slice(0,i+1);
                                                                                console.log('btn.dir.parent',path);
              var result    = await callback('dir','parent',path);
              if(!result){
                    return;
              }
              var {url,auth}    = result;              
              
              dir.parent(url,auth,path);
              
        }//parent
        
        
  //:
  
  
  
        display.clear   = function(){

              ui.path.replaceChildren();
              
              ui.dir.list.replaceChildren();
              ui.file.list.replaceChildren();
              
              display.node.dir    = {};
              display.node.file   = {};
                            
        }//clear
        
        
        display.scroll        = {};
        display.node          = {};
        display.node.dir      = {};
        display.node.file     = {};

        
        obj.display   = function(path,dirs,files){
                                                                                debug('display',path);
                                                                                //console.json(dirs);
                                                                                //console.json(files);
              //display.clear();

              
              $(ui.path).textContent    = path;
              
              
              display(path,'dir',dirs);
              display(path,'file',files);
              
        }//display

        
        function display(path,name,list){
                                                                                //debug('display');
              var ih    = 25;
              var pad   = 5;
              
              var n     = list.length;
              var ns    = n;
              if(ns==0){
                    ns    = 1;
              }
              var t     = ns*ih;

              
              var evt   = {};
              
              obj.onscoll                 = onscroll;
              ui[name].list.onscroll      = onscroll;

              
              ui[name].num.textContent    = n;
              

              var node    = display.scroll[name];
              if(!node){
                    node                    = document.createElement('div');
                    node.className          = 'scroll';
                    display.scroll[name]    = node;
                    ui[name].list.append(node);
              }
              node.style.top   = t+'px';


              var st    = ui[name].list.scrollTop;

              if(n==0){
                    ui[name].list.append(ui[name].empty);
              }else{
                    ui[name].empty.remove();
              }

              
              var i1    = Math.floor(st/ih)-3;
              if(i1<0){
                    i1    = 0;
              }
              
              var h     = ui[name].list.offsetHeight;
              var nh    = Math.floor(h/ih)+3;
              
              var i2    = i1+nh;
              if(i2>list.length){
                    i2    = list.length;
              }

        
              for(var key in display.node[name]){
                
                    if(key<i1 || key>=i2){
                          display.node[name][key].remove();
                          delete display.node[name][key];
                    }
                    
              }//for
                          

              for(let i=i1;i<i2;i++){
                
                    let nitem       = display.node[name][i];
                    let filename    = list[i];
                    
                    if(!nitem){
                          nitem                           = ui[name].item.cloneNode(true);
                          nitem.style.cssText             = 'position:absolute;left:0;right:0';
                          nitem.style.top                 = i*ih+'px';
                          ui[name].list.append(nitem);
                          display.node[name][i]           = nitem;
                          
                          nitem.onmouseenter              = e=>evt.mouseenter(nitem);
                          nitem.onmouseleave              = e=>evt.mouseleave(nitem);
                    }
                    
                    $(nitem,'.name').textContent    = filename;
                    nitem.onclick                   = e=>evt.click(nitem,filename);
                    nitem.ondblclick                = e=>evt.dblclick(nitem,filename);
                    
              }//for
                                                                                //var nn    = Object.keys(display.node[name]).length;
                                                                                //debug(name,nn);
              evt.click   = function(item,filename){
                                                                                console.log('click',name,path);
                    var type    = 'file';
                    
                    if(cur.item!==item){
                          if(cur.item){
                                cur.item.style.background    = '';
                          }
                          item.style.background   = 'lightyellow';
                          
                          var path    = ui.rd.path();
                          cur.set(name,item,path,filename);
                    }else{
                          item.style.background   = '';
                          cur.rem();
                    }
                    
                    
                    if(name==='dir'){
                          type        = 'dir';
                          filename   += '/';
                    }
                                                                                debug('click',path,name,filename);
                    callback(type,'click',path,filename);
                    
              }//click
              
              
              evt.dblclick    = function(item,filename){

                    var type    = 'file';
                    if(name==='dir'){
                          type        = 'dir';
                          filename   += '/';
                    }
                                                                                debug('dblclick',path,name,filename);
                    var result    = callback(type,'dblclick',path,filename);
                    if(!result){
                          return;
                    }
                    
                    if(type=='dir'){
                          var {url,auth}    = result;
                          var path2         = path+filename;
                          dir.read(url,auth,path2);
                    }
                    
              }//dblclick
              

              evt.mouseenter    = function(item){
                
                    if(cur.item){
                          return;
                    }
                    item.style.background   = 'lightyellow';
                    
              }//mouseenter
              
              
              evt.mouseleave    = function(item){
                
                    if(cur.item){
                          return;
                    }
                    item.style.background   = '';
                    
              }//mouseleave
              
              
              function onscroll(e){
                                                                                debug(name,'onscroll');
                    display(path,name,list);
                    
              }//onscroll
              
        }//display


        function callback(type,name,arg0){
                                                                                console.log('callback');
                                                                                console.json(arguments);
              var args    = [...arguments].slice(2);
              
              var result;
              if(typeof(obj[type][name])=='function'){
                    result    = obj[type][name].apply(null,args);
              }
              
              var url;
              var auth;
              
              if(result){
                    ({url,auth}   = result);
              }
              if(!url){
                    if(typeof obj.rd.params=='function'){
                          ({url,auth}   = obj.rd.params());
                    }
              }
              if(!url){
                    alert('url not given');
                    return;
              }
                                                                                console.log(url,auth);
              return {url,auth};
              
        }//callback


  //:
  

        file.add    = async function(url,auth,path,filename){
          
              var file      = path+filename;
              var result    = await server.mkfile(url,auth,file);
              if(!result){
                    return;
              }
              server.readdir(url,auth,path);
              
        }//add
        
        
        file.rem    = async function(url,auth,path,filename){
          
              var file      = path+filename;
              var result    = await server.rmdir(url,auth,file);
              if(!result){
                    return;
              }
              server.readdir(url,auth,path);
              
        }//rem
        
        
        dir.read    = function(url,auth,path){
                                                                                console.log('dir.read',path);
              server.readdir(url,auth,path);
              
        }//read
        
        
        dir.parent    = function(url,auth,path){
                                                                                console.log('dir.parent',path);
              server.readdir(url,auth,path);
              
        }//parent
        

        dir.add   = async function(url,auth,path,name){
                                                                                console.log('dir.add',path,name);
              var dir       = path+name;
              var result    = await server.mkdir(url,auth,dir);
              if(!result){
                    return;
              }
              server.readdir(url,auth,path);
              
        }//add
        
        
        dir.rem   = async function(url,auth,path,name){
                                                                                console.log('dir.rem',path,name);          
              var dir       = path+name;
              var result    = await server.rmdir(url,auth,dir);
              if(!result){
                    return;
              }
              server.readdir(url,auth,path);
              
        }//rem

        
  //:
  
  
        server.mkfile   = async function(url,auth,path){

              var headers   = {mode:'mkfile',auth};
              var full      = url+path;

              var err;
              try{
                
                    var res       = await fetch(full,{headers});
                    
              }
              catch(err2){
                
                    err   = err2;
                    
              }
              if(err){
                    var str   = err.toString();
                    alert(`fetch error\n${str}`);
                    return;
              }
              
              var txt       = await res.text();
              
              if(!res.ok){
                    alert(`mkfile : ${path}\n${txt}`);
                    return;
              }
              return true;
              
        }//mkfile
        
        
        server.rmfile   = async function(url,auth,path){
          
              var headers   = {mode:'rmdir',auth};
              var full      = url+path;
              
              var err;
              try{
                
                    var res       = await fetch(full,{headers});
                    
              }
              catch(err2){
                
                    err   = err2;
                    
              }
              if(err){
                    var str   = err.toString();
                    alert(`fetch error\n${str}`);
                    return;
              }
              
              var txt       = await res.text();
              
              if(!res.ok){
                    alert(`rmfile : ${path}\n${txt}`);
                    return;
              }
              
              return true;
              
        }//rmfile
        
        
        server.rmdir    = async function(url,auth,path){
          
              var headers     = {mode:'rmdir',auth};              
              var full        = url+path;
              
              var err;
              try{
                
                    var res         = await fetch(full,{headers});
                    
              }
              catch(err2){
                
                    err   = err2;
                    
              }
              if(err){
                    var str   = err.toString();
                    alert(`fetch error\n${str}`);
                    return;
              }
              
              var txt         = await res.text();
              
              if(!res.ok){
                    alert(`rmdir : ${path}\n${txt}`);
                    return;
              }
              
              return true;
              
        }//rmdir
        
        
        server.mkdir    = async function(url,auth,path){

              var headers     = {mode:'mkdir',auth};
              var full        = url+path;
              
              var err;
              try{
                
                    var res         = await fetch(full,{headers});
                    
              }
              catch(err2){
                
                    err   = err2;
                    
              }
              if(err){
                    var str   = err.toString();
                    alert(`fetch error\n${str}`);
                    return;
              }
              
              var txt         = await res.text();
              
              if(!res.ok){
                    alert(`mkdir : ${path}\n${txt}`);
                    return false;
              }
              
              return true;
              
        }//mkdir

        
        server.readdir    = async function(url,auth,path){

              var headers     = {mode:'readdir',auth};
              var full        = url+path;

              var err;
              try{
              
                    var res         = await fetch(full,{headers});
                    
              }
              catch(err2){
                
                    err   = err2;
                    
              }
              if(err){
                    var str   = err.toString();
                    alert(`fetch error\n${str}`);
                    return;
              }
              
              var txt         = await res.text();
              
              if(!res.ok){
                    alert('readdir :'+url+'\n'+txt);
                    return false;
              }
              
              var json    = JSON.parse(txt);
                                                                                //debugger;
                                                                                //console.trace('readdir');
              filenav.display(path,json.dirs,json.files);
              return true;
              
        }//readdir

  
  //:


function newfilemod(){  
  
  var obj   = {};
  
  
        obj.init    = function(){
        }//init
        
  
  //:
  
  
        var resolve;
        
        var top_visible   = '5px';
        
        var root;
        var filename;

  
        var on    = {};
        var btn   = {};
        
        
  //:
  
  
        obj.initdom   = function(rootnode){
          
              root                                  = $(rootnode,'#new-file-root');
              
              filename                              = $(root,'#new-file');
              filename.onkeydown                    = on.keydown;
              
              $(root,'.new-file-add').onclick       = btn.ok;
              $(root,'.new-file-cancel').onclick    = btn.cancel;
              
              
        }//initdom
        
        
  //:
  
  
        on.keydown    = function(e){
          
              var handled   = true;
              switch(e.key){
                
                case 'Enter'    : ok();           break;
                case 'Escape'   : cancel();       break;
                
                default         : handled   = false;
                
              }//switch
              
              if(handled){
                    e.preventDefault();
                    return;
              }
              
        }//onkeydown
        
  
        btn.ok    = function(){
          
              ok();
              
        }//ok
        
        
        btn.cancel    = function(){
          
              cancel();
              
        }//cancel
        
        
  //:
  
  
        function ok(){
          
              var fn    = filename.value;
              resolve(fn);
              hide();
              
        }//ok
        
        
        function cancel(){
          
              hide();
          
        }//cancel
        
        
  //:
  
  
        obj.show    = function(){
          
              var promise   = new Promise(res=>resolve=res);
              
              root.style.top      = top_visible;
              filename.focus();
              
              return promise;
              
        }//show
        
        
        obj.hide    = function(){return hide()}
        
        function hide(){
          
              root.style.top      = '';
              
              filename.value      = '';
              filename.blur();
              resolve();
              
        }//hide
        

  //:
  
  
  return obj;
  
//newfilemod
}


  //:
  
  
        function debug(){
          
              if(!df){
                    return;
              }
              
              var str   = [...arguments].join(' ');
              console.log('[ file-nav ]',str);
              
        }//debug


        
        
  return obj;
  
}//filenav

      </script>

</file-nav>



