


<code-block>

      <template shadowrootmode=open>
      
            <style>
  :host
    {--bcol:lightblue}
    
  #root
    {height:100%;border-top:1px solid var(--bcol);padding-top:10px;border-bottom:1px solid var(--bcol);}
    
  code
    {display:block}
    
  editor-root
    {display:block;margin-bottom:5px;}
    
    
            </style>
            
            
            <div id=root>
            
                  <code></code>
            
            </div>
            
      </template>

      
      <script>

      
mod['code-block']   = function(){
  
  var obj   = {};
  
  
        var ext,$,code,menu,ace
        ;
        
        obj.initmod   = function(params){
          
              ext       = params.ext;
              $         = params.$;
              code      = params.code;
              menu      = params.menu;
              ace       = params.ace;
              
        }//initmod
        
        
  //:

  
        var snippet_console;
        obj.snippet_console   = null;

        
        var host;
        var root;
        
        
        
        var setup   = {};
        
  
  //:
  
  
        obj.init    = async function(){
        }//init
        
        
  //:
  
  
        obj.initdom   = async function(rootnode){
          
              if($.nodename(rootnode)=='code-block'){
                    host                = rootnode;
              }else{
                    host                = $.$(rootnode,'code-block');
              }
              root                      = host.shadowRoot;
              
              var dom                   = host.__root;
              var txt                   = dom.textContent;
              var i1                    = txt.indexOf('\n');
              var i2                    = txt.lastIndexOf('\n');
              txt                       = txt.slice(i1+1,i2);

              var node                  = $(root,'code');
              node.textContent          = txt;
              

              var has   = dom.hasAttribute.bind(dom);
              switch(true){
              
                case has('snippet-console')   : setup.snippet_console(dom,node);        break;
                default                       : setup.code(dom,node);                   break;
              }//switch

          
        }//initdom
        
        
  //:
  
  
        setup.code    = async function(dom,node){
        
              var src   = dom.getAttribute('src');
              if(src){
                    var {txt,error}     = await load(src);
                    node.textContent    = txt;
              }
              code.editor.code(node,{menu,ace});
              
        }//code

  
        setup.snippet_console   = async function(){
        
              var src   = dom.getAttribute('src');
              if(src){
                    node.setAttribute('src',src);
              }
              
              var mode;
              var has   = dom.hasAttribute.bind(dom);
              switch(true){
              
                case has('nodejs')    : mode    = 'nodejs';       break;
                
              }//switch
              
              snippet_console       = await code.snippet_console(root,{menu,ace,mode});
              obj.snippet_console   = snippet_console;
              
        }//snippet_console
  
  
  //:
  
  
        async function load(url){
        
              var err;
              try{
              
                    var res   = await fetch(url);
                    
              }//try
              catch(err2){
              
                    err   = err2;
                    
              }//catch
              if(err){
                    var error   = err.toString();
                    return {error};
              }
              
              if(!res.ok){
                    var error   = await res.text();
                    return {error};
              }
              
              var txt   = await res.text();
              return {txt};
              
        }//load
        
        
        
        
  return obj;
  
}//code-block


      </script>
      
</code-block>