

<filemod-root style='display:inline-flex'>

      <template shadowrootmode=open>
      
            <style>
            
                  #root {display:inline-flex;margin-right:5px}
                  
                  github-root {margin-right:10px}
                  
                  .menu {position:absolute;left:0;top:30px}
                  
            </style>
            
            <div id=root style='visibility:hidden'>
            
                  <localfile>
                        <script src='https://html-loader-1024713184986.us-central1.run.app/?localfile'></script>
                  </localfile>
      
                  <github-api>
                        <script src='https://html-loader-1024713184986.us-central1.run.app/?github'></script>
                  </github-api>
                  
                  <button id=save>save</button>
                  
                  <div class=menu-root>
                        <img class=menu-icon>
                        <div class=menu style='display:none'>
                              <checkbox-one id=autosave></checkbox-one>
                        </div>
                  </div>
                  
            </div>
            
      </template>
      
      <script>
      
            filemod   = filemod();
            
            function filemod(){
                                                                                console.log('filemod');
              var obj   = {};

            
                    var menumod
                    ;
                    
                    obj.initmod=function(params){
                      
                          menumod   = params.menumod;
                          
                    }//initmod


                    var cur;
                    Object.defineProperty(obj,'cur',{get:()=>cur,set:v=>cur=v});

                    var autosave;

                    
                    var btn   = {};
                    
                    
                    obj.init=function(){
                    
                        localfile.load.complete   = (txt,path,icon)=>complete.load('localfile',txt,path,icon);
                        localfile.save.complete   = (path,icon)=>complete.save('localfile',path,icon);
                        
                        github.load.complete      = (txt,path,icon)=>complete.load('github',txt,path,icon);
                        github.save.complete      = (path,icon)=>complete.save('github',path,icon);
                        
                    }//init
                    
                    
                    obj.initdom=function(rootnode){
                    
                          root                          = rootnode||$.full('filemod-root');
                          shadow                        = root.shadowRoot;

                          var style                     = $(shadow,'style'); 
                          menumod.add.style(shadow);
                          $.stylesheet.insert(style,'button');

                          
                          localfile.initdom();
                          github.initdom();


                          $(shadow,'#save').onclick         = btn.save;

                          var card                          = $(shadow,'.menu');
                          $(shadow,'.menu-icon').onclick    = menumod.click(card,false,false,menu);

                          autosave                          = $(shadow,'#autosave');
                          autosave.checked                  = false;
                          autosave.onchange                 = e=>obj.autosave   = autosave.checked;
                          obj.autosave                      = autosave.checked;


                          $(shadow,'#root').style.visibility    = '';
                          
                    }//initdom
                    

                    btn.save=function(e){save()}
                    
                    
                    obj.save=function(){return save()}
                    
                    function save(){
                    
                          if(!cur){
                                log.orange('no file');
                                return;
                          }
                          
                          var txt   = editor.getValue();
                          
                          if(cur.type=='github'){
                                github.save(txt);
                          }
                          if(cur.type=='local'){
                                localfile.save();
                          }
                    
                    }//save
                    
                    
                    function menu(type,opt){
                    }//menu
                    
                    
              return obj;
              
            }//filemod
            
      </script>

</filemod-root>


