

<publish-root>

      <template shadowrootmode=open>
      
            <style>
            
                  #root {display:inline-flex}
                  
            </style>
            
            <div id=root style='display:none'>
                  <button style='margin-right:20px'>publish</button>
                  
                  <div class=menu-root>
                        <img class=menu-icon>
                        <div class=menu style='display:none'>
                              <checkbox-one id=autorun></checkbox-one>
                        </div>
                  </div>
            </div>

      </template>
      
      <script>
      
            publish   = publish();
            
            function publish(){
              
              var obj   = {};
              

                    var ui,menumod
                    ;
                    
                    obj.initmod=function(params){
                      
                          ui        = params.ui;
                          menumod   = params.menumod;
                          
                    }//initmod

                                        
                    var mode    = 'jsonblob';
                    var jsonblob;

                    var root;
                    var shadow;

                    var autorun;
                    
                    var btn     = {};


                    init();
                    
                    function init(){

                          var resolve;
                          init.complete   = new Promise(res=>resolve    = res);
                          
                          ext.load.libs('js/io/jsonblob/jsonblob.js')
                            .then(result=>{
                                              
                                  [jsonblob]    = result;
                                  
                                  jsonblob      = jsonblob();
                                  
                                  resolve();
                                  
                            });
                          
                    }//init
                    
                    
                    obj.initdom=function(rootnode){   //c
                      
                          root                              = $.full('publish-root');
                          shadow                            = root.shadowRoot;
                          
                          var style                         = $(shadow,'style');
                          menumod.add.style(shadow);
                          $.stylesheet.insert(style,'button');
                          
                      
                          $(shadow,'button').onclick        = btn.publish;

                          var card                          = $(shadow,'.menu');
                          $(shadow,'.menu-icon').onclick    = menumod.click(card,false,false,menu);

                          autorun                           = $(shadow,'#autorun');
                          autorun.checked                   = false;
                          autorun.onchange                  = e=>obj.autorun   = autorun.checked;
                          obj.autorun                       = autorun.checked;


                          $(shadow,'#root').style.display   = '';
                          
                          
                    }//initdom
                    

                    btn.publish=function(e){
                      
                          switch(mode){
                            
                            case 'jsonblob'   : jsonblob.save();
                            
                          }//switch
                          
                    }//share
  
  //:
  
                    function menu(type,opt){
                    }//menu
                    
  //:
  
                    obj.query=async function(){
                      
                          await init.complete;
                          
                          var json;
                          switch(mode){
                            
                            case 'jsonblob'   : json    = await jsonblob.util.query();        break;
                            
                          }//switch
                            
                          if(json){
                                editor.setValue(json.txt,-1);
                                if(autorun.checked){
                                      run();
                                }
                          }
                          
                    }//load
                    

                    obj.save=function(){
                      
                          var json    = ui.read();
                          switch(mode){
                            
                            case 'jsonblob'   : jsonblob.util.save(json);       break;
                            
                          }//switch
                      
                    }//save
                    

                    obj.delete=function(){

                          switch(mode){
                            
                            case 'jsonblob'   : jsonblob.util.delete();       break;
                            
                          }//switch
                      
                    }//delete

                          
                    
              return obj;
              
            }//share
            
      </script>
      
</publish-root>

