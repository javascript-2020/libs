

<web-editor v2.0>

      <template shadowrootmode=open>
      
            <style>
            
  :host
    {all:initial;font-family:arial}
    
  #root
    {display:flex;flex-direction:column;height:100%}
    
    
    
  #hdr
    {display:flex;position:relative;align-items:center;height:26px;margin-bottom:5px}
    
    
    
  .menu
    {position:absolute;left:0;top:35px;width:600px;}
    
    
  .icon
    {width:27px;height:27px;border:1px solid gray;border-radius:3px;box-sizing:border-box;cursor:pointer}
  .copy
    {padding:2px;
      content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAABSlBMVEVHcEwnz/4C8P4g1P4L6P43wf5Mr/4a2v4Y3P4/uv5PrP4+vf5Auv4ozv5KsP4vyv45wP5Jsf5Auf49vP5Mrv4zxf44wf5Lr/46wP4h1P5Lr/46vv5Jsv4R5P5Hs/5Etv44wf5Hs/41w/4uyv47vv49vP5Ftf5GtP4c2f4rzP4tyv4m0f5Etv5Nrv4xxv4xxv4xx/4W3/5KsP5Mr/4/u/4uyv5Isv4K6f4l0f4qzv4W3/4V3/5Nrv5Mrv5Mrv5Mr/4W3v4e2P5BuP5Hsv4N5v4K6f4O5v42w/5Dt/4E7/4uyf4C8P4nz/4M5/4K6v4oz/4P5f4k0v4b2v5Gs/4E7v4I6/5Nrf4e1/4H7P4E7v5Auv5Dtv4sy/5Isv5GtP4wx/49vP4zxf47vv44wP42w/5LsP5Jsf4i1P4n0P4N5v4k0v4a2v4S4v4X3v6OfcqkAAAAVnRSTlMACo7CjQWN/VczjgIJMfIXJzHtjj5iVekR71Hvtz7CjelXjre2wiJj2PCFIWbR7+fEnXaodz3544/USfOC22Tm7CXOnqfUZ+/3VTV9bsTzqGDahpb2tyRB6bIAAAIDSURBVDjLrZVpV9pAFIYntdFiQkZsLCQECtJSlqAsFRBU3Kuta1sncYGuJEDt///aISkkkyHo6enzLTlP5s5758wNAC526pd3d1++/fzx/evNze1tp210wxURUMTWBz2v2EWtLc7jBTPmoJfNrqy8i0ajixgB00VISJIeW9JMKbcWDAYDNiFMQN1EqAAJcUfSBif0fsQWQjLxpjGnXUJa5CoIbTiP8KJ0OqfNMLQIZhGad/Ke3t///vWwGKv1+yPxfW55+TnmJWZW5ggxcqX3m6WSVTpSdPcxHCLExmf97AI8e1j8cK1f8X9Fq/Sotrf0k2v9KRiJ08L8mwhf2CQx8oK/yJyPw3Q67ULaV4Tr7tRCwFfkllLF4ushccwGPyUMzwzhMQz/X1Kz+QVMmh2LcjgsTxDZ3OpqIpFYfDu+KGwoxE5JvTtpF9NX9BEB792jn0gD4eNEsVAQHyXOO7fQFmNNLZOnPV5BqEyI+Yxm1qkluS0BCWRp8FEze6mTJQtVVd8MUfcEhBSGFOGMOWmaoc0AmRoXP5cmiHEReEXANOopzCsLRYlXjWolGXE2jK/r/ujEWAdOFIxWGrjO8ljXazG6MeynthEn2gAP9P7B4XCE2thzdG2v2jbK5LfHZ3hINbclSco6o/kIh1Einq4e1qxp5m2PkqZ/CPvbXvFot+xe7w/EpaiUrJ24NAAAAABJRU5ErkJggg==);
    }
  .clear
    {padding:2px;
      content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAMAAACKeiw+AAABm1BMVEVHcEySFg+BHxuWGBGZFg+DDwt4EA66IReRGROXEwybFAx2FROQEwyEEg2FGRShGQ+TFQ2jHhexIBaeFAurFw6lFg2fFw+nFgyoGRCdFg6EEAymGRCeFAuYFQ6bFQyfHBXUQDWXFQ/KMSanHRXEKh/CJRqWEgrUTEKeFAueFg66HxW3GxCyGQ6fFQugFQu+KB28IxnHNSqPEQytHxe3HxWOHxy5LCSUFAuWEgrHLCG4KSDINCqUEwvOOzGREQqlGhGMEg2/IxilFgyuGA2tGA6dGA6aFAu1Gg+2GxC4HxW3HBLBKyDAJBm/Ihe7IBXHLSK8IRjOQjivHRTDKB2QEAqNEQqUGBKHIBrGOzLKOCy+JRrWXFOtFgyyGAywFwypFQu2GQ3BHRGmFQuhFAq7Gw/EHxTcT0TIIxfRMSXIJhvHLCDZS0CdFArmfnfqop7PLCG/IBXSNyvYRTrTQDXhWU7OOy/ma2PVOy/fU0nNNSnmdWzkYljohH7rt7TNKR7lZVzTUUfkYFboi4Xkdm/YQDXkbmXfamPqmJPqqKUi9jteAAAAXHRSTlMAMwMtOh0FQBKPxQh1IxVXaRoowNW3ReerfCV3+IPPD/Jh7Y+Zpf7s20394evn/ebZ+Uiobw3WpOGmx+C329ZcsF3t5fCe1uzo9M76iLO1+H72v7vy3V0L775T7MqXpbYAAAHuSURBVCjPbZJle+JAFIUHdylSpECBInWXrbfbdXedCIGECO5QoKVd+9lNutmlhJxPc5935sqZC5TfviaThzGdEkik1cVXHeD0e6HXK+STMYcE7kbZdxMgnu/9KRQKv38dng4TKHW74Up0RgPA8Zfrq6tuPt/thF9Mi9QRC9e4vXXhutK2fXndzXcajYtqfEKA+s391uCt8PRWGt/25c9OY1Cjyi95rntfGdT2I9phH5bgCnVx3uKq7CvVmyh1zu2pR6dQbKxRLa7OllbaVK26oZFOaYqs1it1lilz1NrMNBiXyvu83W5WKq+ntEBO6gW2+aPJ4JuyVPeMocvlEo4vTsrQuQWGpul5FEEQl2OM2p5ki3TxqcGI8vJuSejxY7JfLM77gN8JUYhOSd4uprL9fslg4i1yQgg9I7ZMnqXILFNyW4XAb8QwzK2/M7ErQ5JZ0qUSwxCGEcP0ejeSSZHkg7n/BswShEfxL/JBPJNKIcFhuvUlgvCaxN/wIDzOOK13mrEH0gHb3715iCE4nrk/YpXWkEsbb+8rliCK4NAwOqn1ILdsFw7mZQgRZNYi8UlxLxcSVmsnjUGUMI+5bA/k7CKGj8bWA2h3EiG+ejBHYGmzzBf6jxKfhCJpsUmpIomDz3xvH47UsvuxdfLRcgP/mm5ojkTjOQAAAABJRU5ErkJggg==);
    }
    
    
  .menu #sha256-root
    {display:flex;flex-direction:column;border:1px solid lightgray;padding:5px}
  .menu #sha256-root #value-root
    {display:flex;gap:5px}
  .menu #sha256-root #value
    {flex:1;border:1px solid lightgray;padding:5px 10px;font-family:monospace;overflow:auto}
    
    
  #menu-icon
    {width:15px;height:26px;border:1px solid gray;padding:2px;background:buttonface;margin-right:10px;box-sizing:border-box;cursor:pointer;border-radius:3px;
      content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAt1BMVEVHcEwbmPYcgfMchvQbsfkay/wbtvkbnfccefMayfwbmfYch/QchvQbtfkbmfYa1P0ddfIcivQcl/Ycj/Ubp/gcmfYdbPEbrvkazPwcmfYbqfgayfwayPwbv/sbvvobsvkazPwbqvga0fwbvPobtvocjvUbofcbpvccfPMcgPMcgvMdafAdbfEckfUbtvka0PwcfPIaxvsbwfsbvPodb/EcnPYclvYckfUbpvccjPQdd/IbofcbrPiPy8D0AAAAMHRSTlMAA/79/v7+5ycVZ3Y3h0xhu9jp8kFeF9OkVfQOrZi+Mh1z/iUJQ+/dx4fOYq7hybzs5xU1AAABIklEQVQ4y+2Ux3aDMBBFpTR6M92AwYB7S6EG/v+7MsJJnBBKVsnGdwHozT1HQgxC6MrfEkiSM+Y4khSgUxhazLDHWGF4QveAO2gyLnGQ9QS4wcDaXGJYiPGegVnU50UzUvdgTsd7AfrMaEaqXvO+sfAAHP0uzz+SmhCfR7FwB5gdpm+SyoeHEJ5P67o2tbanmRBP5/iSgFkUxaplaisIv3kAu6yqihK/RiIF0ZJtT6NTaZpS9iWwm0D/uXB7kmXZ5LOgN0O7ayvEQ57nKtssCbMqDA5i9+YulLIsVQ5MzKnwqCz6Phev3AIcxhy5K3x/A/DbG2CzIdctP9RS9PrxnTU92KOYll8bZHqs7Wk5AcY9hIx9kuyN3/xuxm5nXA+df+cNJSAgjMbiFSoAAAAASUVORK5CYII=)
    }
    
    
    
    
    
  #filename-root
    {/*display:flex;align-items:center*/ margin-right:20px}
  #filename-icon
    {width:20px;height:20px;margin-right:5px;box-sizing:border-box;vertical-align:middle;
    }
  #filename-save
    {width:20px;height:20px;margin-right:5px;box-sizing:border-box;vertical-align:middle;
      content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoBAMAAAB+0KVeAAAAKlBMVEX/pQD/////qhH/pAD/rhr/zHH/yGT/wlP//vz/8dn/tjD/+u//6MD/2ZUL9bZAAAAA30lEQVQoz2OQvuWihARUMgUFBRlamRkYlqXBQLoy10Sg4CUGBisgDQLSu3dLXGBeAxRczMBg3ggR3LZqaeMhBquDggzOCMFdxuZAQWYfQQYHuKDELgOQINA0JEFBqCDzSiwqGdiwqGRgYlDAVIksSIpKYyyC28E+ggoi/L5D8AJMkGFZKAyEKcAFjRGAAS6IBsCCzMbGKGpBgkwqLshAASzoOxMFHDEACjJXCKKANmyCYkNI0IEGgs7YBBdjCpowXGBejSq43YCVYSszV1ooEkgrMMhmkL6lhAIUlJZuBAAfSYTf2T2EkwAAAABJRU5ErkJggg==)
    }
  #filename
    {margin:5px 0;flex:1}
    
  #spc
    {flex:1}
    
  button
    {height:26px;padding:0 5px;margin-right:5px;font-size:16px;cursor:pointer}
  #paste
    {margin-right:10px}
    
  #info
    {display:flex;align-items:center;margin-right:20px}
  #sep
    {margin:0 10px}
    
  #row,#col
    {width:40px;height:26px;text-align:center;box-sizing:border-box;font-size:16px}
  #row
    {margin-right:5px}
  #col
    {margin-right:10px}
    
  #top,#bottom
    {width:20px;height:20px;border:1px solid dimgray;padding:2px;border-radius:3px;cursor:pointer;}
  #top
    {margin-right:5px;
     content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAsCAMAAAAgsQpJAAAAP1BMVEVHcExEpvVCpvZLpu5Mpexare1EpfNBpvRFpvNGpvNSp+xuq9xHpvFiq+RHpvFMpu5CpvRTp+mrtLlQp+xBpvbrVekHAAAAFHRSTlMA9P1dHz2e3sy7KgR3CoxQ6xUBM2Gq4CQAAAEASURBVDjL7dVJEoMgEAVQBILM8/3PmsQWFQewKskuf+PmFWh3gwj9JCY9GkmmOMr80IgXEly0uR3MFGwsOjDzMEHFelDMbyk5boY/ytcERxpx9NOqqhDMneITxrnQ3e0ow1AR13FLTb2755oy0qpHnlxBuevllZSHnnsSew5fS8nnSZmefq7ScJCLS9MsjdKeywQOc4kAUlOkVkeXX65AdCaLmw5HgUiBxKus3AqR0kMlaXEwMSuMBmQeoJsOb90GLmtmFldYXAWLtHBixNbVEOSY5uHSTAd0Dl8bWpuW+drWdA8v84ffge+LGo+hD917DKzqw0gEt+HebyfED67XJz8tJngV1cZbAAAAAElFTkSuQmCC)
    }
  #bottom
    {content:url(data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAsBAMAAADlQedIAAAAMFBMVEVHcExDpvVLpu5CpvZNpexYrO1EpfNmq+JBpvRFpvNGpvNSp+xHpvGrtLlHpvFBpvabmoDrAAAAD3RSTlMA81r9HDqeBt7Muyp3AYxdzYCkAAABLElEQVQoz2NgwAvYfTHFeLXmOWAIMsn/f44hyPf/cwuGINv//4Nc8DoWQZZjR5AFmd4FAEmv/78cEILsB/+3Ainl//+XIARr5P//gwiClEIEgQr/f7vAwOD5H6wULMgLVPhfCKiSdT5Q6QaIIEih4XGQfTuBSldDBOvs/3+WKWCAKv25ASTI/vj//4/HIS4FKv08GyQIVPgfopCB4TZIadj//90ghbowT4FMnfn/vxhQodAFmCD3eqDo/89AMUNdhP93/YcChEKYUqBCBeTk4QVViBLEV8BKfyigBrwXpkKg0mSgWxXQ46goc9YRzLR4xZ2BEHBSQgEqYIdPNkYBlqDYLPuPBpYDBavQBacABe+hiX1OB6WQREEUILUBZFNpKAoIh4bRXSRwAZfLAT6sAtz4b+DtAAAAAElFTkSuQmCC)
    }
    
  #editor
    {flex:1}
    
    
    
            </style>
            
            <div id=root part=root>
            
                  <div id=hdr>
                  
                        <img id=menu-icon>
                        
                        <div class=menu style='display:none'>
                        
                              <div id=trim class=menu-opt>trim</div>
                              <div id=wordwrap class=menu-opt>word wrap</div>
                              
                              <div id=sha256-root>
                                    <div id=sha256 class=menu-opt>
                                          sha256
                                    </div>
                                    <div id=value-root>
                                          <img class='copy icon'>
                                          <img class='clear icon'>
                                          <div id=value>---</div>
                                    </div>
                              </div>
                        </div>
                        
                        <div id=filename-root>
                              <img id=filename-icon src='data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAP1BMVEVHcEwVFRUICAgkJCQMDAwLCwsNDQ1QUFAICAgrKysQEBAVFRUHBwcLCwsZGRkKCgoHBwfd3d0ICAgkJCQEBATHNF52AAAAFXRSTlMAQ9IblZl1BbQOXDbHiiWj1wG2H/ZbTuAhAAAA5klEQVQ4y72V2w6DIAxAKQjIRRT1/791gkg226mJc+elSE5qqYCMPQV0zY4uUF7grdwxc0cl5NNuxvjBO0oUuxnhbUPkxKLxYCQ2yYzMSPT2LMbCmpFbRphJtH0B0ozu/TJsZy+QCF1hTTKpNG4GOKlxK5XfEKNOsBIzkRTt2C5AVDkmRkuKTiUCA1Vx92q8LDqFcAeLeefLYt7actyeyzUKVwnM5ChIUQ2VJgJPUZGiCZXtwdyrURuEpvvoEXQfg0XQX0b/fFN84PIxgwuiTAfX/mXjTtdE4iJdaXk4u5rLBQ2P/Q1eGdEQZZzIbegAAAAASUVORK5CYII='>
                              <img id=filename-save style='display:none'>
                              <span id=filename>filename</span>
                        </div>
                        
                        <div id=info>
                              <div id=lines>0</div>
                              <div id=sep>/</div>
                              <div id=chars>0</div>
                        </div>
                        
                        <span id=spc></span>
                        
                        <input id=row value=0>
                        <input id=col value=0>
                        
                        <button id=clear>clear</button>
                        <button id=copy>copy</button>
                        <button id=paste>paste</button>
                        
                        <img id=top>
                        <img id=bottom>
                        
                  </div>
                  
                  <div id=editor></div>
                  
            </div>
            
      </template>
      
      <script>
      
(function web_editor({mod,dom,host}){

  var obj   = {
        version   : 'v2.0'
  };
  
        var df=true,did='web-editor'
        ;
        
        var ext,$,menu,menumod,ace,kd2,on2,config={},embed
        ;
        
        
        obj.initmod   = function(params){
        
              ext                 = mod.rd(params,'ext',ext);
              $                   = mod.rd(params,'$',$);
              menumod             = mod.rd(params,'menumod',menumod);
              menu                = mod.rd(params,'menu',menu);
              ace                 = mod.rd(params,'ace',ace);
              def.fullsize        = mod.rd(params,'fullsize',def.fullsize);
              kd2                 = mod.rd(params,'kd',kd2);
              embed               = mod.rd(params,'embed',embed);
              on2                 = mod.rd(params,'on',on2);
              config              = mod.rd(params,'config',config,{});
              def.mode            = mod.rd(params,'mode',def.mode);
              
        }//initmod
        
        
  //:
  
  
        var editor;
        
        
        var src;
        
        
        var shadow;
        
        var card;
        
        var hdr;
        var row;
        var col;
        
        var deficon;
        
        
        
        var target      = dom;
        
        var def         = {};
        def.txt         = '';
        def.fullsize    = false;
        def.mode        = 'javascript';
        def.height      = null;
        
        
        
        
        var rd          = {};
        rd.attr         = {};
        var kd          = {};
        var btn         = {};
        var on          = {};
        var setup       = {};
        
        
        
        
        
        
        
        
  //:
  
  
        obj.init    = async function(){
                                                                                debug('init',obj.version);
              var dom_config    = mod.rd.config(dom);
              config            = Object.assign(config,dom_config);
                                                                                debug('config',config);
                                                                                
              ({$,menumod}    = await libs2());
              
              if(!menu){
                    menu    = menumod();
              }
              
              if(embed){
                    target    = embed;
              }
              
              
              rd.txt();
              rd.attr.fullsize();
              rd.attr.mode();
              rd.attr.h();
              rd.attr.height();
              
              
              await Promise.all([
                    rd.attr.src(),
                    libs(),
              ]);
              
              
        }//init
        
        
  //:
  
        async function libs(){
        
/*
              if(!ace){
                    ace       = await $.editor.ace();
                    obj.ace   = ace;
              }
*/

              var src   = [
                    'https://cdn.jsdelivr.net/npm/ace-builds@1.37.0/src-min-noconflict/ace.js',
                    'https://ajaxorg.github.io/ace-builds/src-noconflict/ace.js',
              ];
              
              var resolve,promise=new Promise(res=>resolve=res);
              
              var script      = document.createElement('script');
              script.src      = src[1];
              script.onload   = onload;
              document.head.append(script);
              
              return promise;
              
              
              function onload(){
              
                    resolve(window.ace);
                    
              }//onload
              
        }//libs
        
        
        async function libs2(){
        
              var get   = url=>fetch(url).then(res=>res.text());
              
              if(!$){
                    var js    = await get('https://libs.ext-code.com/js/dom/$.js');
                    $         = eval(`${js}`);
              }
              if(!menumod && !menu){
                    var js    = await get('https://libs.ext-code.com/js/dom/menumod/menumod.js');
                    menumod   = eval(`${js};(menumod)`);
              }
              if(typeof datatype=='undefined'){
                    var js    = await get('https://libs.ext-code.com/js/core/datatype.js');
                    window.eval(js);
              }
              if(typeof keydown=='undefined'){
                    var js    = await get('https://libs.ext-code.com/js/dom/keydown/keydown.js');
                    window.eval(js);
              }
              
              return {$,menumod}
              
        }//libs2
        
        
        rd.attr.fullsize   = function(){
        
              if(!target.hasAttribute('fullsize'))return;
              
              def.fullsize    = true;
              
        }//fullsize
        
        
        rd.attr.src    = async function(){
        
              if(!target.hasAttribute('src'))return;
              
              src   = target.getAttribute('src');
              
              var err;
              try{
              
                    var res   = await fetch(src);
                    
              }//try
              catch(err2){
              
                    err   = err2;
                    
              }//catch
              if(err){
              
                    var error   = errtoString();
                    def.txt     = error;
                    return;
              }
              if(!res.ok){
                    var error   = res.status+' '+res.statusText;
                    def.txt     = error;
                    return;
              }
              
              var txt   = await res.text();
              def.txt   = txt;
              
        }//src
        
        
        rd.attr.mode   = function(){
        
              if(!target.hasAttribute('mode'))return;
              
              def.mode    = target.getAttribute('mode');
              
        }//mode
        
        
        rd.attr.h   = function(){
        
              if(!target.hasAttribute('h'))return;
              
              var h         = target.getAttribute('h');
              h             = int(h);
              def.height    = h;
              
        }//h
        
        
        rd.attr.height    = function(){
        
              if(!target.hasAttribute('height'))return;
              
              var h         = target.getAttribute('height');
              h             = int(h);
              def.height    = h;
              
        }//height
        
        
        rd.txt    = function(){
        
              //$.htmlentities.decode(dom);
              
              var txt   = '';
              target.childNodes.forEach(node=>{
              
                      if(node.nodeType==Node.TEXT_NODE){
                            txt  += node.nodeValue;
                      }
                      
              });
              def.txt   = txt;
              
        }//txt
        
        
        
  //:
  
  
        obj.initdom    = async function(rootnode,params){
        
              if(arguments.length==1){
                    params                    = rootnode;
              }
              
              var {mode,txt,fullsize,height}   = params||{};
              
              mode            ||= config.mode||def.mode;
              txt             ||= def.txt;
              fullsize        ||= config.fullsize||def.fullsize;
              
              height          ||= config.height||def.height;
              if(height){
                    fullsize    = false;
              }
              
              var cssText   = config.cssText;
              
              
              
              shadow            = host.shadowRoot;
              obj.shadowRoot    = shadow;
              
              root                                        = $(shadow,'#root');
              
              menu.add.style(shadow);
              var style                                   = $(shadow,'style');
              
              
              hdr                                         = $(shadow,'#hdr');
              
              card                                        = $(shadow,'.menu');
              $(shadow,'#menu-icon').onclick              = menu.click(card,'both',false,click);
              
              var sha256_root                             = $(card,'#sha256-root');
              $(sha256_root,'.copy').onclick              = async e=>{
              
                                                                  var txt   = $(card,'#sha256-root #value').textContent;
                                                                  await navigator.clipboard.writeText(txt);
                                                                  
                                                            }//copy
              $(sha256_root,'.clear').onclick             = async e=>{
              
                                                                  $(card,'#sha256-root #value').textContent   = '';
                                                                  
                                                            }//clear
                                                            
              deficon                                     = $(hdr,'#filename-icon').src;
              
              $(shadow,'#clear').onclick                  = btn.clear;
              $(shadow,'#copy').onclick                   = btn.copy;
              $(shadow,'#paste').onclick                  = btn.paste;
              
              row                                         = $(hdr,'#row');
              row.onkeydown                               = kd.row;
              row.onmousedown                             = e=>e.target.select();
              col                                         = $(hdr,'#col');
              col.onkeydown                               = kd.col;
              col.onmousedown                             = e=>e.target.select();
              
              $(hdr,'#top').onclick                       = btn.top;
              $(hdr,'#bottom').onclick                    = btn.bottom;
              
              
              var node                                    = $(shadow,'#editor');
              node.textContent                            = txt;
              
              if(fullsize){
                                                                                  debug('fullsize');
                    setup.fullsize(node,{mode,kd:kd2});
              }else{
                    setup.editor(node,{mode,kd:kd2});
              }
              
              
              
              if(src){
                    filename(src);
              }
              
              
              if(height){
                                                                                debug('height',height);
                    obj.height    = height;
              }
              
              if(cssText){
                    host.style.cssText    = cssText;
              }
              
                                                                                debug(editor.container.offsetHeight);
              if(editor.container.offsetHeight==0){
                                                                                debug('xxx  failsafe  xxx');
                    //host.style.height   = def.height;
                    
              }
              
              
              editor.resize();
              update();
              
              
        }//initdom
        
        
  //:
  
  
        setup.editor    = function(node,{mode,kd}={}){
        
              mode    ||= 'javascript';
              
              switch(mode){
              
                case 'nodejs'     :
                case 'node-js'    :
                case 'js'         : mode    = 'javascript';       break;
                
              }//switch
              
              
              
              if(kd){
                    node.onkeydown    = kd;
              }
              
              node.addEventListener('mousedown',update);
              node.addEventListener('keyup',update);
              
              
              
              editor    =  ace.edit(node);
              editor.setShowInvisibles(false);
              editor.setShowPrintMargin(false);
              editor.setPrintMarginColumn(false);
              editor.setBehavioursEnabled(false);
              editor.setDisplayIndentGuides(false);
              editor.setScrollSpeed(2);
              editor.setFontSize(16);
              editor.session.setOptions({tabSize:2,useSoftTabs:true});
              editor.session.setMode('ace/mode/'+mode);
              editor.session.on('change',on.change);
              
              editor.focus();
              
              $.editor.ace.import_style(shadow);
              
              
        }//editor
        
        
        setup.fullsize    = function(node,params={}){
        
              node.style.flex                   = 'none';
              //$(shadow,'#root').style.height    = 'auto';
              
              setup.editor(node,params);
              
              editor.session.on('change',onchange);
              editor.setOption('maxLines',Infinity);
              
              onchange();
              
              return editor;
              
              
              function onchange(e){
                                                                                //console.log('onchange');
                    var lh      = editor.renderer.lineHeight;
                    var lines   = editor.session.getLength();
                    var h       = lh*lines;
                    
                    var w       = editor.renderer.scrollBar.getWidth()
                    h          += w;
                    
                    editor.container.style.height   = h+'px';
                    editor.resize();
                    
              }//onchange
              
        }//fullscreen
        
        
        
        
        
        var initial   = true;
        
        on.change   = function(e){
        
              update();
              
              if(initial){
                    initial=false;
                    return;
              }
              
              filename.save(true);
              
              if(on2?.change){
                    on2.change();
              }
              
        }//onchange
        
        
        
        kd.row    = function(e){
        
              if(e.key=='Enter'){
                    e.preventDefault();
                    var pos   = editor.getCursorPosition();
                    var r     = row.value;
                    var col   = pos.column;
                    editor.gotoLine(r,col);
                    editor.focus();
              }
              
        }//row
        
        
        kd.col    = function(e){
        
              if(e.key=='Enter'){
                    e.preventDefault();
                    var pos   = editor.getCursorPosition();
                    var row   = pos.row;
                    var c     = col.value;
                    editor.gotoLine(row,c);
                    editor.focus();
              }
              
        }//col
        
        
        btn.clear   = function(e){
        
              clear();
              
        }//clear
        
        
        btn.copy    = function(){
        
              var txt       = editor.getValue();
              navigator.clipboard.writeText(txt)
                .catch(err=>log.error(err));
                
        }//copy
        
        
        btn.paste   = function(){
        
              navigator.clipboard.readText()
                .then(txt=>editor.setValue(txt,-1))
                .catch(err=>log.error(err));
                
        }//paste
        
        
        btn.top   = function(){
        
              editor.gotoLine(0,0);
              editor.focus();
              update();
              
        }//top
        
        
        btn.bottom    = function(){
        
              editor.gotoLine(999999,0);
              editor.focus();
              update();
              
        }//bottom
        
        
  //:
  
  
        obj.filename    = filename;
        
        function filename(file){
        
              var src         = deficon;
              var filename    = 'html-editor';
              var title       = '';
              
              if(file){
                    if(typeof file=='string'){
                          filename    = file;
                    }else{
                          src         = file.icon;
                          filename    = file.name||file.filename;
                          title       = file.title;
                    }
              }
              
              var fn    = filename.split('/').at(-1);
              
              $(shadow,'#filename-icon').src      = src;
              
              $(shadow,'#filename').textContent   = fn;
              $(shadow,'#filename').title         = title;
              
        }//filename
        
        
        filename.getname    = function(path){
        
              var name;
              var i   = path.lastIndexOf('/');
              if(i==-1){
                    name    = path;
              }else{
                    name    = path.slice(i+1);
              }
              
        }//getname
        
        
        filename.save   = function(status){
        
              var display   = '';
              if(!status){
                    display   = 'none';
              }
              $(shadow,'#filename-save').style.display   = display;
              
        }//saveicon
        
        
        filename.save.show    = function(){
        
              filename.save(true);
              
        }//show
        
        
        filename.save.hide    = function(){
        
              filename.save(false);
              
        }//hide
        
        
        obj.filename.clear    = function(){
        
              filename();
              filename.save.hide();
              
        }//filename
        
        
  //:
  
  
        function update(){
        
              if(!editor)return;
              
              var pos                       = editor.getCursorPosition();
              row.value                     = pos.row+1;
              col.value                     = pos.column;
              
              var n                         = editor.getValue().split('\n').length;
              $(hdr,'#lines').textContent   = n;
              
              var n                         = editor.getValue().length;
              $(hdr,'#chars').textCottent   = n;
              
        }//update
        
        
  //:
  
        obj.clear   = function(status=false){
        
              editor.setValue('',-1);
              filename(status);
              
        }//clear
        
        
        obj.setValue    = function(txt){return set(txt)}
        obj.setvalue    = function(txt){return set(txt)}
        obj.set         = function(txt){return set(txt)}
        
        function set(txt){
        
              editor.setValue(txt,-1);
              update();
              
        }//set
        
        
        obj.getValue    = function(){return get()}
        obj.getvalue    = function(){return get()}
        obj.get         = function(){return get()}
        
        
        function get(){
        
              var txt   = editor.getValue();
              return txt;
              
        }//get
        
        
        obj.focus   = function(){
        
              editor && editor.focus();
              
        }//focus
        
        
        obj.resize    = function(){
        
              editor.resize();
              
        }//resize
        
        
  //:
  
  
        obj.horiz   = function(){
        
              host.style.width    = '100%';
              host.style.height   = '50%';
              
        }//horiz
        
        
        obj.vert    = function(){
        
              host.style.width    = '50%';
              host.style.height   = '100%';
              
        }//vert
        
        
  //:
  
  
        obj.clear   = function(){return clear()}
        
        function clear(){
        
              editor.setValue('',-1);
              
        }//clear
        
        
        Object.defineProperty(obj,'height',{
        
              set   : v=>{
              
                    if(v===undefined){
                          return;
                    }
                    v   = int(v);
                    if(typeof v=='number'){
                          v   = v+'px';
                    }
                    
                    //editor.container.style.height   = v;
                    root.style.height    = v;
                    
                    
              },//set
              
        });
        
        
  //:
  
  
        function click(type,opt){
        
              if(type=='opt'){
                    click[opt.id]();
              }
              
        }//menu
        
        
        click.trim   = function(){
        
              var pos     = editor.getCursorPostion();
              var txt     = editor.getValue();
              var lines   = txt.split('\n');
              lines       = lines.map(line=>line.trimEnd());
              txt         = lines.join('\n');
              editor.setValue(txt,-1);
              editor.gotoLine(pos.row+1,pos.col);
              
        }//trim
        
        
        click.wordwrap   = function(){
        
              var wrap1   = editor.getOption('wrap');
              if(wrap1=='off'){
                    editor.setOption('wrap',true);
              }else{
                    editor.setOption('wrap',false);
              }
              var wrap2   = editor.getOption('wrap');
                                                                                console.log('wrap',wrap1,'->',wrap2);
        }//wordwrap
        
        
        click.sha256   = function(){
        
              var txt   = editor.getValue();
              sha256(txt);
              
        }//sha256
        
        
        
        async function sha256(txt){
        
            const msg   = new TextEncoder().encode(txt);
            const buf   = await crypto.subtle.digest('SHA-256',msg);
            
            var uint8   = new Uint8Array(buf);
            var hex     = uint8.reduce((a,byte)=>a   += byte.toString(16).padStart(2,'0'),'')
            
            $(card,'#sha256-root #value').textContent   = hex;
            console.log(hex);
            
        }//sha256
        
        
        function int(str){return (/^\d+$/.test(str)) ? Number(str) : str}
        
        
        
        
  //:
  
  
        function debug(...args){
        
              if(!df && !obj.df)return;
              args.unshift(`[ ${did} ]`);
              var fmt     = Array.from({length:args.length}).fill('%O').join(' ');
              var args2   = [fmt].concat(args);
              console.groupCollapsed.apply(console,args2);
              console.trace();
              console.groupEnd();
              
        }//debug
        
        
  return obj;
  
})//web_editor

      </script>
      
</web-editor>

