


<web-console v2.0>

      <template shadowrootmode=open>
      
            <style>
            
  #console
    {border:1px solid lightgray;min-height:50px}
    
    
  #ftr
    {display:flex;gap:10px}
    
  #ftr>div
    {display:flex;}
    
  .icon
    {width:20px;height:20px;border:1px solid lightgray;border-radius:3px;box-sizing:border-box}
  #clear
    {}
  #log-icon
    {}
  #warn-icon
    {}
  #error-icon
    {}
    
            </style>
            
            
            <div id=console part=console>
            </div>
            
            
            <div id=ftr>
            
                  <img id=clear>
                  
                  <div id=log-root>
                        <img id=log-icon>
                        <div id=log></div>
                  </div>
                  
                  <div id=warn-root>
                        <img id=warn-icon>
                        <div id=warn></div>
                  </div>
                  
                  <div id=error-root>
                        <img id=error-icon>
                        <div id=error></div>
                  </div>
                  
            </div>
            
            
      </template>
      
      
      <script>
      
      
(function web_console({mod,dom,host}){

  var obj   = {
        version   : 'v2.0',
  };
  
        var df=obj.df=true,did='web-console'
        ;
        
        var ext,$,ace,embed,config={}
        ;
        
        obj.initmod   = function(params){
        
              ext       = mod.rd(params,'ext',ext);
              $         = mod.rd(params,'$',$);
              ace       = mod.rd(params,'ace',ace);
              embed     = mod.rd(params,'embed',embed);
              config    = mod.rd(params,'config',config,{});
              echo      = mod.rd(params,'echo',echo);
              
        }//initmod
        
        
  //:
  
  
        var ansi;
        
        
        
        var echo    = true;
        
        
        
        var jsconsole;
        var con;
        var style;
        
        
        var root;
        
        
        var def       = {};
        
        def.height    = '200px';
        
        
        var rd    = {};
        rd.attr   = {};
        
        
        
        
        
  //:
  
  
        obj.init    = async function(){
                                                                                debug('init',obj.version);
              var node    = $(dom,'config');
              if(node){
                    node.remove();
              }
              node      = mod.config(node);
              if(node.error){
              }
              config    = Object.assign(config,node.config);
                                                                                debug('config',config);
                                                                                
              target    = dom;
              if(embed){
                    target    = embed;
              }
              
              rd.attr.h();
              rd.attr.height();
              if(config.h){
                    def.height    = config.h;
              }
              if(config.height){
                    def.height    = config.height;
              }
              
              await libs();
              
              
        }//init
        
        
        async function libs(){
        
              if(!ace){
                    ace   = await $.editor.ace();
              }
              
              var list      = [];
              
              var promise   = ext.load.libs('js/dom/web-console/web-console.js').then(result=>{
              
                    [jsconsole]=result;
                    jsconsole.initmod({ace});
                    jsconsole.init();
                    
              });
              list.push(promise);
              
              
              var promise   = ext.text.libs('js/dom/web-console/web-console.css').then(result=>{
              
                    var [css]           = result;
                    style               = document.createElement('style');
                    style.textContent   = css;
                    
                    
              });
              list.push(promise);
              
              
/*
              var promise   = import('https://cdn.jsdelivr.net/npm/ansi_up/+esm').then(({AnsiUp})=>{
              
                    ansi    = new AnsiUp();
                    
              });
              list.push(promise);
*/



              await Promise.all(list);
              
        }//libs
        
        
  //:
  
  
        var int   = (str)=>(/^\d+$/.test(str)) ? Number(str) : str;
        
        rd.attr.h   = function(){
        
              if(target.hasAttribute('h')){
                    var h         = target.getAttribute('h');
                    h             = int(h);
                    def.height    = h;
              }
              
        }//h
        
        
        rd.attr.height    = function(){
        
              if(target.hasAttribute('height')){
                    var h         = target.getAttribute('height');
                    h             = int(h);
                    def.height    = h;
              }
              
        }//height
        
        
  //:
  
  
        obj.initdom    = function(){
        
              var shadow    = host.shadowRoot;
              
              
              $.editor.ace.import_style(shadow,()=>shadow.append(style));
              
              
              var node    = $(shadow,'#console');
              con         = jsconsole.create(node);
              obj.height  = def.height;
              
              
        }//initdom2
        
        
        
        
  //  ext
  
        obj.write   = function(){
        
              con.write.apply(con,arguments);
              if(echo){
                    window.console.log.apply(window.console,arguments);
              }
              
        }//write
        
        
        obj.json    = function(){
        
              var args    = [...arguments];
              args.forEach(v=>{
              
                    var str   = JSON.stringify(v,null,4);
                    obj.log(str);
                    
              });
              
        }//json
        
        
        obj.debug   = function(...args){
        
              args.unshift('[ debug ]');
              con.log.apply(con,args);
              
              if(echo){
                    window.console.debug.apply(window.console,args);
              }
              
        }//debug
        
        
        
  //  standard
  
  
        var api         = [
                                'assert','clear','count','countReset','debug','dir','dirxml','error','group','groupCollapsed',
                                'groupEnd','info','log','profile','profileEnd','table','time',
                                'timeEnd','timeLog','timeStamp','trace','warn'
                          ];
                          
        api.forEach(name=>{
        
              var fn      = ()=>{};
              if(window.console[name]){
                    fn    = window.console[name].bind(window.console);
              }
              obj[name]   = fn;
              
        });
        
        
        obj.log   = function(){
        
              con.log.apply(con,arguments);
              
              if(echo){
                    window.console.log.apply(window.console,arguments);
              }
              
        }//log
        
        
        obj.clear   = function(){
        
              con.clear.apply(con);
              
              if(echo){
                    window.console.clear();
              }
              
        }//clear
        
        
        obj.error   = function(){
        
              con.error.apply(con,arguments);
              
              if(echo){
                    window.console.error.apply(window.console,arguments);
              }
              
        }//error
        
        
        obj.warn    = function(){
        
              con.warn.apply(con,arguments);
              
              if(echo){
                    window.console.warn.apply(window.console,arguments);
              }
              
        }//warn
        
        
        
        
  //:
  
  
        obj.test    = function(){
        
        
              con.log('helloworld');
              
              var test    = {
                    hello:'world',
                    key:'value',
                    test:123,
                    debug:true
              };
              
              con.log(test);
              
              
        }//test
        
        
        Object.defineProperty(obj,'height',{
        
              set   : v=>{
                                                                          //window.console.log('console.height',v);
                    if(!v)return;
                    if(typeof v=='number'){
                          v   = v+'px';
                    }
                    con.element.style.height    = v;
                    
              },
              
        });
        
        
        Object.defineProperty(obj,'echo',{
        
              set   : v=>echo=!!v
              
        });
        
        
        
        
  //:
  
  
        function debug(...args){
        
              if(!df && !obj.df)return;
              args.unshift(`[ ${did} ]`);
              window.console.groupCollapsed.apply(window.console,args);
              window.console.trace();
              window.console.groupEnd();
              
        }//debug
        
        
  return obj;
  
  
})//web_console


      </script>
      
      
</web-console>





