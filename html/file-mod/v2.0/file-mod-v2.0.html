

<file-mod v2.0>

      <template shadowrootmode=open>
      
            <style>
            
  :host
    {all:initial;font-family:arial}
    
    
  #root
    {display:inline-flex;gap:5px;margin-right:5px;position:relative}
    
  .icon
    {border:1px solid gray;border-radius:3px;box-sizing:border-box;width:30px;height:30px;cursor:pointer}
    
    
            </style>
            
            
            <div id=root style='visibility:hidden'>
            
                  <local-file component></local-file>
                  <file-server component></file-server>
                  <github-fs component></github-fs>
                  <db-files component></db-files>
                  <google-storage component></google-storage>
                  <ftp-server component></ftp-server>
                  <electron-fs component></electron-fs>
                  
            </div>
            
            
      </template>
      
      <script>
      
      
      
(function filemod({mod,host}){

  var obj       = {
        version   : 'v2.0'
  };
  
        var df=false,did='file-mod'
        ;
        
        
        
        var ext,$,menumod,menu,complete,source,focus,log
        ;
        
        obj.initmod   = function(params){
        
              ext             = mod.rd(params,'ext',ext);
              $               = mod.rd(params,'$',$);
              menumod         = mod.rd(params,'menumod',menumod);
              menu            = mod.rd(params,'menu',menu);
              complete        = mod.rd(params,'complete',complete);
              source          = mod.rd(params,'source',source);
              focus           = mod.rd(params,'focus',focus);
              log             = mod.rd(params,'log',log);
              
        }//initmod
        
        
  //vars:-
  
        var localfile;
        var github;
        var fileserver;
        var dbfiles;
        var googlestorage;
        var ftpserver;
        var electron;
        
        var cur;
        Object.defineProperty(obj,'cur',{get:()=>cur,set:v=>cur=v});
        
        
        var root;
        var shadow;
        
        
        var btn   = {};
        
        
  //:
  
  
        obj.init    = async function(){
                                                                                debug('init',obj.version);
                                                                                
            if(!menumod){
                  menumod   = menu.menumod;
            }
            
            
            var filemod   = obj;
            //mod.base.add({filemod,source,log});
            //await mod.auto();
            if(!ext)debugger;
            
            
            localfile                 = mod['local-file'];
            obj.localfile             = localfile;
            
            fileserver                = mod['file-server'];
            obj.fileserver            = fileserver;
            obj.fs                    = fileserver;
            
            github                    = mod['github-fs'];
            obj.github                = github;
            
            dbfiles                   = mod['db-files'];
            obj.dbfiles               = dbfiles;
            
            googlestorage             = mod['google-storage'];
            obj.googlestorage         = googlestorage;
            obj.gs                    = googlestorage;
            
            ftpserver                 = mod['ftp-server']
            obj.ftpserver             = ftpserver;
            
            electron                  = mod['electron-fs'];
            obj.electron              = electron;
            
            
            localfile.initmod({ext,$,menu,filemod:obj,source});
            fileserver.initmod({ext,$,menu,filemod:obj,source});
            github.initmod({ext,$,menu,filemod:obj,source});
            dbfiles.initmod({ext,$,datatype,menumod,menu,filemod:obj,source});
            googlestorage.initmod({ext,$,menumod,menu,filemod:obj,source});
            ftpserver.initmod({ext,$,datatype,menu,source,log});
            electron.initmod({ext,$,menu,source,log});
            
            
            await Promise.all([
                  localfile.init(),
                  fileserver.init(),
                  github.init(),
                  dbfiles.init(),
                  googlestorage.init(),
                  ftpserver.init(),
                  electron.init(),
            ]);
            
            
            complete                        ||= {};
            localfile.load.complete           = complete.load;
            localfile.save.complete           = complete.save;
            fileserver.load.complete          = complete.load;
            fileserver.save.complete          = complete.save;
            github.load.complete              = complete.load;
            github.save.complete              = complete.save;
            dbfiles.load.complete             = complete.load;
            dbfiles.save.complete             = complete.save;
            googlestorage.load.complete       = complete.load;
            googlestorage.save.complete       = complete.save;
            ftpserver.load.complete           = complete.load;
            ftpserver.save.complete           = complete.save;
            electron.load.complete            = complete.load;
            electron.save.complete            = complete.save;
            
            
            
        }//init
        
        
  //:
  
  
        obj.initdom   = function(){
        
              shadow                            = host.shadowRoot;
              
              var style                         = $(shadow,'style');
              menu.add.style(shadow);
              
              export_icon_css();
              
              
              localfile.initdom();
              github.initdom();
              fileserver.initdom();
              dbfiles.initdom();
              googlestorage.initdom();
              ftpserver.initdom();
              electron.initdom();
              
              
              $(shadow,'#root').style.visibility    = '';
              
              
              
              
        }//initdom
        
        
  //:
  
  
        obj.save    = function(file){return save(file)}
        
        async function save(file){
                                                                                debug('save');
              if(!file){
                    if(!cur){
                          log.orange('no file');
                          return;
                    }
                    file    = cur;
              }
                                                                                debug(file);
                                                                                
              var blob    = await source();
              
              var type    = file.filetype||file.type;
              switch(type){
              
                case 'github'               : await github.save(file,blob);               break;
                case 'localfile'            : await localfile.save(file,blob);            break;
                case 'file-server'          : await fileserver.save(file,blob);           break;
                case 'db-files'             : await dbfiles.save(file,blob);              break;
                case 'google-storage'       : await googlestorage.save(file,blob);        break;
                case 'ftp-server'           : await ftpserver.save(file,blob);            break;
                case 'electron'             : await electron.save(file,blob);             break;
                
              }//switch
              
        }//save
        
        
        obj.clear   = function(){
        
              if(!cur){
                    return 'no file';
              }
              var type    = cur.filetype||cur.type;
              switch(type){
              
                case 'github'           : github.clear();               break;
                case 'local'            : localfile.clear();            break;
                case 'file-server'      : fileserver.clear();           break;
                case 'db-files'         : dbfiles.clear();              break;
                case 'google-storage'   : googlestorage.clear();        break;
                case 'ftp-server'       : ftpserver.clear();            break;
                case 'electron'         : electron.clear();             break;
                
              }//switch
              
              cur   = null;
              
        }//clear
        
        
  //:
  
  
        obj.new       = newfile;
        obj.newfile   = newfile;
        
        
        function newfile({
        
              filetype,ft,
              
              abs,path,
              name,filename,
              rel,
              
              kind,
              size,
              ctime,mtime,atime,
              
              title,icon
              
        }){
        
              filetype===undefined && (filetype=null);
              ft===undefined && (ft=null);
              abs===undefined && (abs=null);
              path===undefined && (path=null);
              name===undefined && (name=null);
              filename===undefined && (filename=null);
              rel===undefined && (rel=null);
              kind===undefined && (kind=null);
              size===undefined && (size=null);
              ctime===undefined && (ctime=null);
              mtime===undefined && (mtime=null);
              atime===undefined && (atime=null);
              title===undefined && (title=null);
              icon===undefined && (icon=null);
              
              
              var file          = {};
              
              file.filetype     = filetype||ft;
              file.ft           = filetype||ft;
              file.type         = filetype||ft;
              
              
              file.abs          = abs;
              file.path         = path;
              file.name         = name||filename;
              file.filename     = name||filename;
              
              file.rel          = rel;
              
              file.kind         = kind;
              file.size         = size;
              file.ctime        = ctime;
              file.mtime        = mtime;
              file.atime        = atime;
              
              file.title        = title;
              file.icon         = icon;
              
              return file;
              
        }//new
        
        
        obj.export    = function(file){
        
              if(!file){
                    if(!cur){
                          return 'no file';
                    }
                    file    = cur;
              }
              
              var type    = file.filetype||file.type;
              switch(type){
              
                case 'github'           : file    = github.export(cur);               break;
                case 'local'            : return 'local';
                case 'file-server '     : file    = fileserver.export(cur);           break;
                case 'db-files'         : file    = dbfiles.export(cur);              break;
                case 'google-storage'   : file    = googlestorage.export(cur);        break;
                case 'ftp-server'       : file    = ftpserver.export(cur);            break;
                case 'electron'         : file    = electron.export(cur);             break;
                
              }//switch
              
              //file.filetype   = type;
              //file.type       = type;
              
              return file;
              
        }//export
        
        
        obj.import    = function(file){
        
        }//import
        
        
        
  //:
  
  
        function export_icon_css(){
        
              var style   = $(shadow,'style');
                                                                                //console.log(style);
              var sheet   = style.sheet;
              var rules   = sheet.cssRules;
                                                                                //console.log(rules);
              var rule    = [...rules].find(rule=>rule.selectorText=='.icon');
                                                                                //console.log(rule);
              var css     = rule.cssText;
              var style   = document.createElement('style');
              style.textContent   = css;
              document.head.append(style);
              
        }//export_icon_css
        
        
  //:
  
  
        function debug(...args){
        
              if(!df && !obj.df)return;
              args.unshift(`[ ${did} ]`);
              var fmt     = Array.from({length:args.length}).fill('%O').join(' ');
              var args2   = [fmt].concat(args);
              window.console.groupCollapsed.apply(window.console,args2);
              window.console.trace();
              window.console.groupEnd();
              
        }//debug
        
        
        
  return obj;
  
//filemod
})

      </script>
      
</file-mod v2.0>


