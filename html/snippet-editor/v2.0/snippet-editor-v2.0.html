


<snippet-editor v2.0>


      <template shadowrootmode=open>
      
            <style>
    
  #root
    {display:flex;flex-direction:column;gap:10px;border:1px solid lightgray;padding:10px;border-radius:5px;
      /*height:100%*/
    }
    
  input
    {font-size:16px;padding:5px 10px}
  input[type=button]
    {cursor:pointer}

    
            </style>
            
            <div id=root>
            
                  <div>
                        <file-mod component></file-mod>
                  </div>
                  
                  <web-editor component></web-editor>
                  
            </div>
      
      </template>
      
      
      <script>

      
(function snippet_editor({mod,dom,host}){

  var obj   = {
        version   : 'v2.0',
  };
  
        var df=true,did='snippet-editor'
        ;
        
        
        var ext,$,menu,ace,menumod,log
        ;
        
        obj.initmod   = function(params){
        
              ext       = params.ext;
              $         = params.$;
              menu      = params.menu;
              ace       = params.ace;
              menumod   = params.menumod;
              log       = params.log;
              
        }//initmod
        
        
  //:

  
        var filemod;
        obj.filemod   = null;
        var editor;
        obj.editor    = null;
        
        var def   = {};
        
        var src;

        
        var rd    = {};

        
  //:
  
  
        obj.init    = async function(){
                                                                                debug('init',obj.version);
              
              def.txt       = $.htmlentities.decode(dom);
              
              var node    = host.shadowRoot;
              var mode      = rd.mode();
              
              if(mode){
                    $(node,'web-editor').setAttribute('mode',mode);
              }
              if(rd.fullsize()){
                    $(node,'web-editor').toggleAttribute('fullsize',true);
              }
              

              filemod         = mod['file-mod'];  
              obj.filemod     = filemod;
              editor          = mod['web-editor'];
              obj.editor      = editor;

              
              filemod.initmod({ext,$,menu,menumod,complete,source});
              editor.initmod({ext,$,menu,menumod,ace,embed:dom});
              
              await Promise.all([
                    rd.src(),
                    filemod.init(),
                    editor.init(),
              ]);
              
              
        }//init
        
        
        rd.src    = async function(){
          
              if(!dom.hasAttribute('src'))return;
              src       = dom.getAttribute('src');
              var res   = await fetch(src);
              var txt   = await res.text();
              def.txt   = txt;
              
        }//src


        rd.mode   = function(){
          
              if(!dom.hasAttribute('mode'))return;
              def.mode    = dom.getAttribute('mode');
              return def.mode;
              
        }//mode
        
        
        rd.fullsize   = function(){
          
              if(!dom.hasAttribute('fullsize'))return;
              def.fullsize    = true;
              return true;
              
        }//fullsize
        

  //:
  
  
        obj.initdom    = function(){

              var shadow                          = host.shadowRoot;

              filemod.initdom();
              editor.initdom();

              if(src){
                    editor.filename(src);
              }
              
        }//initdom
        

  //:
  
  
        function source(){
          
              var txt     = editor.getvalue();
              var blob    = new Blob([txt]);
              return blob;
              
        }//source
        
        
        function complete(file){
        }//complete
        
        
        complete.load   = function(file,blob){
        }//load

        
        complete.save   = function(file){
          
              (log||window.log)?.green(file.name+' saved');
              
        }//save
        
  
  //:
  
        
        function debug(){
          
              if(!df && !obj.df)return;
              var str   = [...arguments].join(' ');
              console.log(`[ ${did} ]`,str);
              
        }//debug


  
  return obj;
  
})//snippet_editor


      </script>

      
</snippet-editor>