


<console-root>

      <template shadowrootmode=open>
      
            <style>
            
  #console
    {border:1px solid lightgray;height:50px}
    
    
  #ftr
    {display:flex;gap:10px}
    
  #ftr>div
    {display:flex;}
    
  .icon
    {width:20px;height:20px;border:1px solid lightgray;border-radius:3px;box-sizing:border-box}
  #clear
    {}
  #log-icon
    {}
  #warn-icon
    {}
  #error-icon
    {}
    
            </style>

            
            <div id=console>
            </div>


            <div id=ftr>
            
                  <img id=clear>
                  
                  <div id=log-root>
                        <img id=log-icon>
                        <div id=log></div>
                  </div>
                  
                  <div id=warn-root>
                        <img id=warn-icon>
                        <div id=warn></div>
                  </div>
                  
                  <div id=error-root>
                        <img id=error-icon>
                        <div id=error></div>
                  </div>
                  
            </div>

      
      </template>
      
      
      
      
      <script id=console>
      

(function console_mod({mod,root,host}){
  
  var obj   = {
        version   : 'v2.0',
  };
  
        var df=true,did='console'
        ;
        
        var ext,$,ace
        ;
        
        obj.initmod   = function(params){
          
              ext       = params.ext;
              $         = params.$;
              ace       = params.ace;
              
        }//initmod
        
        
  //:

        
        var ansi;
        
        
    
  
        var jsconsole;
        var con;
        var style;
        
        
        var root;
    
    
        var def       = {};
        
        def.height    = '200px';
        var int   = (str)=>(/^\d+$/.test(str)) ? Number(str) : str;
        if(root.hasAttribute('h')){
              var h   = root.getAttribute('h');
              h       = int(h);
              def.height    = h;
        }
        if(root.hasAttribute('height')){
              var h   = root.getAttribute('height');
              h       = int(h);
              def.height    = h;
        }
        
        
        
  
  //:
  
  
        obj.init    = async function(){
                                                                                debug('init',obj.version);
          
              await libs();

              
        }//init
        

        async function libs(){
          
              if(!ace){
                    ace   = await $.editor.ace();
              }
              
              var list      = [];
              
              var url       = 'javascript-2020:external:/TarVK/chromeConsole/console.js';
              var promise   = ext.text.github(url).then(result=>{
                       
                    [jsconsole]   = result;
                    jsconsole     = eval(jsconsole);
                    jsconsole.initmod({ace});
                    jsconsole.init();
                    
              });
              list.push(promise);
              
              var url       = 'javascript-2020:external:main:TarVK/chromeConsole/console.css';
              var promise   = ext.text.github[url].then(css=>{
                
                    style         = document.createElement('style');
                    style.textContent   = css;
              
              });
              list.push(promise);

/*              
              var promise   = import('https://cdn.jsdelivr.net/npm/ansi_up/+esm').then(({AnsiUp})=>{
                
                    ansi    = new AnsiUp();
                    
              });
              list.push(promise);
*/              
              
              await Promise.all(list);
              
        }//libs


  //:
  
  
        obj.initdom   = function(rootnode){return obj.initdom2()}
        
        obj.initdom2    = function(){

              var shadow    = host.shadowRoot;
              

              $.editor.ace.import_style(shadow,()=>shadow.append(style));
              
              
              var node    = $(shadow,'#console');
              con         = jsconsole.create(node);
              obj.height  = def.height;

          
        }//initdom2
  




/*

        function import_style(shadow,complete){

              if(!import_style.ct){
                    import_style.ct   = 0;
              }
              import_style.ct++;
              if(import_style.ct>10){
                                                                      console.log('import_style timeout');
                    complete();
                    return;
              }

              
              var ids   = ['ace-tm','ace_editor\\.css','ace_scrollbar\\.css','error_marker\\.css',];
              var n     = ids.length;
              for(var i=0;i<n;i++){
              
                    var id      = ids[i];
                    var style   = $('#'+id);
                    if(!style){
                          setTimeout(import_style,500,shadow,complete);
                          return;
                    }
                    
              }//for
              
              for(var i=0;i<n;i++){
              
                    var id      = ids[i];
                    var style   = $('#'+id);
                    var copy    = style.cloneNode(true);
                    shadow.append(copy);
              
              }//for
              
              if(complete){
                    complete();
              }
              
        }//style
        
*/        
        
  //:
  
  
        obj.write   = function(){
          
              con.log.apply(con,arguments);
              
        }//write
        
  
        obj.log   = function(){
          
              con.log.apply(con,arguments);
              
        }//log


        obj.clear   = function(){
          
              con.clear.apply(con);
              
        }//clear


        obj.error   = function(){
          
              con.error.apply(con,arguments);
              
        }//error


        obj.debug   = function(){
          
              var args    = [...arguments];
              args.unshift('[ debug ]');
              con.log.apply(con,args);
              
        }//debug
        
        

/*        

5
: 
"error"
6
: 
"warn"
7
: 
"info"
8
: 
"clear"
9
: 
"time"
10
: 
"timeEnd"

*/


  
        obj.test    = function(){
          

              cons.log('helloworld');
              
              
              
              var test    = {
                    hello:'world',
                    key:'value',
                    test:123,
                    debug:true
              };
              
              con.log(test);
              
              
        }//test


        Object.defineProperty(obj,'height',{
          
              set   : v=>{
                                                                          //window.console.log('console.height',v);
                    if(!v)return;
                    if(typeof v=='number'){
                          v   = v+'px';
                    }
                    con.element.style.height    = v;
              },
              
        });

/*        
        obj.height    = function(h){
        
              cons.element.style.height   = h;
              
        }//height
*/        

        
  //:
  

        function debug(){
          
              if(!df && !obj.df)return;
              var str   = [...arguments].join(' ');
              window.console.log(`[ ${did} ]`,str);
              
        }//debug
        
        
  return obj;
  
  
})//console


      </script>
      
      
</console-root>





